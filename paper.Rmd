---
title: "La Socialización de la Meritocracia:   El rol de la Familia y la Escuela"
css: "input/css/custom.css" # custom CSS para html
linestretch: '1.5'          # interlineado
link-citations: yes         # citas linkeadas
author:
- name: Juan Carlos Castillo ^[Autor para correspondencia - juancastillov@uchile.cl - http://jc-castillo.com/]
  number: 1,2
- name: Julio Iturra
  affiliation: Centro de Estudios de Conflicto y Cohesión Social
  number: 2
- name: Francisco Meneses
  affiliation: Departamento de Sociología, Universidad de Chile
  number: 1
- name: Martín Venegas
  number: 1
# Nota: Autores que comparten filiacion, poner el mismo number y declarar filiación una sola vez.
abstract: La meritocracia se entiende como un sistema de distribución en base a esfuerzo y talento individual. Este sistema ha sido ampliamente cuestionado por su rol en la legitimación de las desigualdades sociales, dado que llevaría a atribuir el éxito o fracaso personal a factores personales por sobre determinantes sociales. La presente investigación se enfoca en cómo se aprenden algunas nociones de meritocracia en la etapa escolar, atendiendo a la posible influencia de agentes socializadores como son la familia y la escuela. Utilizando datos de estudiantes y sus familias en 3 regiones de Chile (N= 1,635 estudiantes de 64 escuelas) se analiza en qué medida las percepciones meritocráticas de padres se asocian a las de sus hijas e hijos, así como también la influencia de la experiencia escolar de justicia en las notas. Los resultados dan cuenta, parcialmente, de que las percepciones meritocráticas son transmitidas intergeracionalmente a nivel familiar. Sin embargo, encontramos escasa evidencia de que esa relación se vea afectada por la experiencia de justicia distributiva en la escuela.
output:
  bookdown::pdf_document2:
    template: null
    toc: false
    keep_tex: false
    pandoc_args:
      - --template=input/mytemplate.tex #custom template para usar autores con afiliacion
  bookdown::html_document2:
    number_sections: false
linkcolor: blue                         # enlaces y citas en color azul
bibliography: input/bib/socializacion-merit.bib     # bibliografia en bibtex
csl: input/bib/apa.csl
editor_options:
  chunk_output_type: console            # en RStudio, mostrar output en consola
geometry: "left=2cm,right=2cm,top=3cm,bottom=3cm" # márgenes de página
header-includes:
  - \usepackage[spanish,es-tabla,es-nodecimaldot]{babel}
  - \usepackage{times}           # Times New Roman
  - \usepackage{caption}
  - \captionsetup[figure]{labelfont={bf},labelformat={default},labelsep=period,name={Figura}}
  - \captionsetup[table]{labelfont={bf},labelformat={default},labelsep=period,name={Tabla}}
  - \usepackage{graphicx}
  - \usepackage{float}
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, cache = TRUE)

if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, lavaan, summarytools, haven, sjPlot, htmlwidgets, ggplot2, sjmisc, texreg, webshot, utils, sjlabelled, rvest, fastDummies) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE,      # incluir chunk en output
                      fig.width = 10,
                      fig.height = 7,
                      fig.align = 'center'
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
rm(list=ls())       # limpiar workspace
options(knitr.kable.NA = '') # NA en kable = ''

# Funciones para renderizar tablas tanto en HTML como en pdf.
table_format = if(is_html_output()) { # Usar en argumento "format=" de kable
  "html"
} else if(is_latex_output()) {
  "latex"
}

fwidth = if(is_html_output()) { #Usar en argumento "full_width" de kableExtra
  T
} else if(is_latex_output()) {
  F
}

format_size = if(is_html_output()) { # Usar en argumento "format=" de kable
 20
} else if(is_latex_output()) {
  10
}

stars.pval2=function (p.value) # Usar en correlaciones policloricas
 {
    unclass(symnum(p.value, corr = FALSE, na = FALSE, cutpoints = c(0,
        0.001, 0.01, 0.05, 1), symbols = c("***",
        "**", "*", " ")))
}

graph.magnif_table = if(is_html_output()) { # Usar en argumento "graph.magnif=" de summarytools
  1.2
} else if(is_latex_output()) {
  0.75
}

width_table = if(is_html_output()) {
  800
} else if(is_latex_output()) { # Usar en "width=" dentro del argumento "image=" en kable
  500
}

```

# Introducción

La meritocracia es un ideal que aspira a la distribución de los recursos en una sociedad según esfuerzo y talento personal [@young_rise_2006]. Este ideal se encuentra ampliamente extendido en las sociedades modernas donde se alza como una forma legítima de progresar individualmente en base a logros personales, contrario a la antigua distribución en base a herencias y a las ventajas que pueden generar otro tipo de actividades como sobornos o uso de contactos personales [@hadjar_meritokratie_2008]. Si bien la obtención de recompensas proporcionales a esfuerzo y talento parece una representación fidedigna de la justicia por equidad, la implementación de sistemas meritocráticos no está exenta de problemas. Por un lado, se ha argumentado que la meritocracia permite la legitimación de las desigualdades mediante la atribución del éxito al logro personal, subestimando de esta manera las condiciones de origen o el "punto de partida" [@hadjar_meritokratie_2008; @bay-cheng_agency_2015]. Ello implica una gran presión psíquica y social hacia los jóvenes, quienes independiente de las desigualdades de sus contextos, crecen rodeados de discursos meritocráticos que contrastan constantemente con la realidad [@allen_top_2016]. Por otro lado, el énfasis en las capacidades individuales llevaría a responsabilizar a las personas de su situación y por lo tanto a un menor apoyo a políticas sociales que compensen desventajas: "¿Por qué las personas que triunfan en la vida iban a deber nada a los miembros menos favorecidos de la sociedad?" [@sandel_tirania_2021 p.292]. De esta manera, la creencia en la meritocracia podría mermar la preocupación por el bien común y la solidaridad.

En el último tiempo se ha incrementado el interés por el estudio de la meritocracia en las ciencias sociales. Desde la sociología, se ha desarrollado una agenda de investigación que ha resaltado los aspectos subjetivos de la meritocracia [@mijs_how_2020, @mijs_inequality_2018, @castillo_meritocracia_2019 ], donde una distinción central es entre percepciones meritocráticas (que tan meritocrática es la sociedad) y preferencias meritocráticas (que tan meritocrática debería ser la sociedad)  [@reynolds_perceptions_2014, @castillo_meritocracia_2019] siendo las percepciones el objeto principal de este estudio. Sin embargo, hasta ahora se ha puesto poca atención al origen de estas percepciones en etapas previas a la vida adulta. Desde una perspectiva de socialización, distintos agentes tienen el potencial de contribuir a la formación de percepciones, actitudes y creencias en los jóvenes, siendo dos de ellos los más importantes la familia y la escuela [@gidengil_political_2016a; @torney-purta_school_2002]. En el presente trabajo, nuestro objetivo es estudiar en qué medida las ideas parentales y las experiencias escolares se asocian a percepciones meritocráticas de estudiantes secundarios. Basados en los trabajos sobre justicia en la escuela y en la agenda de socialización política familiar, buscamos responder dos preguntas:¿Existe una asociación entre las percepciones meritocráticas de los padres con las de sus hijos/hijas? Y, ¿En qué medida la experiencia escolar en términos de justicia distributiva (en relación a las notas) se vincula a las percepciones meritocráticas de las/los estudiantes?

En relación a la primera pregunta, nuestro interés es analizar en qué medida las percepciones meritocráticas de los padres se encuentran asociadas a las de sus hijos. Los estudios sobre la reproducción intergeneracional de actitudes políticas han generado vasta evidencia en torno a la transmisión de habilidades, creencias, actitudes y prácticas para el ejercicio de la vida social y política [@astill_multilevel_2002; @miranda_desigualdad_2018]. En esta línea, se ha estudiado la transmisión de opiniones e intenciones de participación política [@boonen_adolescent_2013; @quintelier_intergenerational_2015a], las creencias políticas sobre la democracia [@greenstein_personality_2016] y orientaciones políticas [@jennings_politics_2009]. No obstante, estas investigaciones por lo general no incorporan aspectos relativos a la justicia distributiva, los cuales pueden ser fundamentales si se considera que las ideas de las personas sobre la desigualdad y la distribución de recursos pueden generar apatía política e incluso deseos de insubordinación [@easterbrook_social_2021], además de estar relacionadas con la tolerancia y las ideas autoritarias [@madeira_primes_2019a; @azevedo_neoliberal_2019]. De esta manera, esta investigación busca contribuir al cuerpo de estudios sobre socialización política incorporando otras ideas transmisibles en el entorno familiar, como son las percepciones meritocráticas.

El segundo tema de interés en este trabajo es el rol de la escuela en las percepciones meritocráticas de los estudiantes. Al respecto, la literatura sobre justicia en la escuela ha logrado evidenciar la importancia que tienen las experiencias distributivas en la configuración de la visión del mundo en los jóvenes. Trabajos como lo de Resh y Sabbagh han demostrado que el sentido de justicia que tienen los estudiantes con respecto a la distribución de notas tiene un impacto en sus actitudes y comportamientos democráticos [@resh_sense_2014; @resh_sense_2017], así como también en la confianza institucional y social [@resh_sense_2018]. Esta evidencia llama a profundizar en el efecto del sentido de justicia en otros aspectos de la visión del mundo de los jóvenes, como por ejemplo las percepciones de meritocracia. Esta propuesta se refuerza si se considera el potencial efecto de la escuela en la forma en que se percibe la desigualdad de una sociedad.

# Antecedentes conceptuales y empíricos

## Sobre el estudio subjetivo de la desigualdad

El estudio de la desigualdad social ha tenido un lugar central en la sociología. Por un lado, está el desarrollo de la investigación en el ámbito de la estratificación social, donde se ha puesto atención en las características de la estructura social y en los mecanismos de reproducción de la desigualdad [@kerbo_estratificacion_1998; @chan_class_2007; @lopez-roldan_comparative_2021]. Por otro lado, y de manera posterior a los estudios clásicos de estratificación, se ha desarrollado un ámbito de investigación que propone estudiar las actitudes distributivas de los individuos en relación a su posición en la estructura social, principalmente a través de sus percepciones y preferencias en torno a la desigualdad económica [@kluegel_beliefs_2017; @kluegel_social_2018; @janmaat_subjective_2013; @jensen_deservingness_2017]. Una de las dimensiones que ha sido abordada desde esta perspectiva se relaciona con la legitimidad de la desigualdad en ámbitos como los salarios [@evans_justifications_2010] o el acceso a bienestar social [@maldonado_risk_2019].  En este marco, desde un enfoque de interés racional se sostiene que la posición relativa de los individuos en la estructura social - representada a través de los ingresos, logro educacional y posición en el mercado laboral - trae consigo que individuos de mayor estatus manifiesten actitudes menos igualitarias, y por tanto, tiendan a justificar mayor desigualdad [@meltzer_tests_1983; @gugushvili_intergenerational_2016]. Sin embargo, una segunda línea de investigación se enmarca en la así denominada _desigualdad subjetiva_, que plantea que las actitudes de los individuos hacia la desigualdad no solo se ven afectadas por su posición objetiva y su interés racional, sino que también son influenciadas por otros elementos culturales, normativos y experienciales [@mcleod_handbook_2014a].

Frente a la amplitud de conceptos utilizados en los estudios sobre desigualdad subjetiva, autores como @jasso_new_1980 o @janmaat_subjective_2013 han realizado precisiones conceptuales con el objetivo de clarificar la comprensión del campo de estudio. Según @janmaat_subjective_2013 los tres principales conceptos sobre desigualdad subjetiva son percepciones de desigualdad (estimaciones subjetivas sobre la desigualdad existente), creencias sobre la desigualdad (ideas normativas de justicia respecto a cómo debería ser la desigualdad), y por último, juicios sobre la desigualdad (evaluaciones sobre que tan buena o mala es la situación actual). Dentro de este marco, el presente estudio se enfoca en las percepciones de desigualdad, específicamente en la estimación de la magnitud en que los esfuerzos y talentos son recompensados, lo que denominamos percepción de meritocracia [@castillo_meritocracia_2019].

## Percepción de meritocracia

La evidencia sobre los aspectos asociados a las percepciones meritocráticas son variadas y se han centrado en distintos ámbitos, entre ellos la información a la que los individuos se encuentran expuestos. En general, las investigaciones muestran que los sujetos poseen estimaciones sesgadas tanto de los niveles de desigualdad como del real funcionamiento de la meritocracia [@gimpelson_misperceiving_2018]. De modo similar, @mccall_exposure_2017 evidencian que exponer a los ciudadanos estadounidenses a los reales niveles de desigualdad fomenta en ellos una menor creencia en las oportunidades para salir adelante en base al esfuerzo propio. En la misma línea, @mijs_how_2020 señalan que al exponer a ciudadanos indonesios, australianos y mexicanos a los niveles reales de desigualdad y movilidad social disminuye su percepción de meritocracia. Estas percepciones distorsionadas sobre la desigualdad y la meritocracia varían consistentemente según nivel socioeconómico, pues las personas aventajadas socioeconómicamente suelen percibir mayores niveles de meritocracia que las personas de escasos recursos [@reynolds_perceptions_2014].

La adhesión a creencias meritocráticas suele ser interpretada desde una perspectiva de interés racional, considerando que quienes detentan mayores recursos económicos y estatus poseen mejores razones para percibir y preferir la meritocracia [@kunovich_systems_2007]. Adicionalmente, se ha evidenciado que dichas diferencias en la percepción según nivel socioeconómico se ven afectadas por el nivel de desigualdad económica de la sociedad, lo cual es abordado desde distintas teorías. Por un lado, la teoría del conflicto supone que mayores niveles de desigualdad generan menor percepción de meritocracia y menor tolerancia a la desigualdad, a la vez que existe mayor disenso en estos temas entre distintos estratos sociales [@newman_false_2015]. Por otro lado, la teoría del poder relativo [@solt_economic_2016] sostiene que mayor desigualdad económica trae consigo una mayor concentración de riqueza y poder, lo cual tiene como consecuencia que las visiones de los grupos más aventajados permeen las visiones de aquellos más desaventajados, por lo cual a mayor desigualdad existe mayor consenso entre grupos sociales sobre la percepción de meritocracia. En síntesis, se puede decir que la percepción de meritocracia es mayor en grupos aventajados, sin embargo la brecha respecto a los más pobres tiende a ser menor en sociedades más desiguales.

Otra característica del estatus-socioeconómico relevante en el estudio de las percepciones y preferencias meritocráticas ha sido la tenencia de credenciales educativas que dan paso a ocupaciones de mayor calificación en el mercado laboral [@goldthorpe_myth_2003a]. Para explicar la relación entre creencias meritocráticas y años de educación se ha recurrido a dos hipótesis. Por un lado está el enfoque *reproduccionista* [@bourdieu_reproduccion_1998; @bernstein_poder_1988], desde donde se sostiene que el rol de la institución escolar contribuye a reforzar los principios meritocráticos de los individuos, por tanto un mayor logro educacional se traduce en mayor adscripción a la meritocracia como principio distributivo [@reynolds_perceptions_2014; @xian_bootstraps_2017; @lampert_meritocratic_2013]. Por otro lado, se encuentra la hipótesis de *instrucción*, la cual sostiene que individuos más educados poseen mayor capacidad crítica respecto del rol que juegan los factores estructurales e individuales en la adquisición de recompensas en la sociedad, lo cual se traduce en un debilitamiento en torno al ideal meritocrático [@duru-bellat_who_2012; @castillo_meritocracia_2019].

## Meritocracia en la etapa escolar

La investigación sobre meritocracia en población joven ha sido escasamente abordada, pero si es posible encontrar algunos estudios sobre actitudes hacia la desigualdad y la justicia. En lo que refiere a actitudes hacia la desigualdad, los estudios han demostrado que los niños son capaces de formar nociones acerca de justicia y desigualdad a muy temprana edad [@imhoff_nociones_2015]. Si bien los niños más pequeños presentan problemas para comprender los términos de "rico" y "pobre" [@danziger_child_1957a], durante los 3 y 6 años ya logran entenderlos, aunque no son capaces explicar estas diferencias hasta alrededor de los 10 años [@sigelman_age_2013]. En esta edad, los niños tienden a destacar en gran medida las atribuciones individuales de tipo meritocrático como causantes de la desigualdad [@sigelman_rich_2012], a la vez que presentan incipientes explicaciones basadas en la desigualdad de oportunidades, especialmente como consecuencia de la discriminacion [@imhoff_nociones_2015]. No obstante, algunos autores señalan que las atribuciones multifacéticas de la desigualdad pueden encontrarse a edades menores. Por ejemplo, un estudio con niños de 5 a 8 años dio cuenta de que en esta etapa los niños eran capaces de explicar la pobreza a partir de factores como el esfuerzo individual y elementos situacionales, aludiendo a desigualdades salariales y discriminación [@mistry_children_2016]. Según estos autores, los resultados son coherentes con la teoría del desarrollo cognitivo [@leahy_parental_1981] y del construccionismo social [@emler_children_1985], donde un mayor desarrollo cognitivo posibilitará una comprensión más acabada de la desigualdad.

Además de la comprensión y explicación de los niños frente a la desigualdad, algunos estudios han profundizado en el uso de criterios de justicia distributiva por parte de los niños. En esta línea @kanngiesser_young_2012 señalan que pese a su tendencia egoísta, los niños entre 3 y 5 años ya son capaces de utilizar criterios meritocráticos para distribuir recursos, considerando el esfuerzo invertido de otros niños aun cuando esto podría afectar su propio interés. En suma, los niños y niñas a temprana edad son capaces de comprender conceptos relativos a la desigualdad, a la vez que son capaces de utilizar distintos criterios de distribución para explicar dichas diferencias o asignar recursos.

En relación a estudios sobre meritocracia en población adolescente, @hjort_individualized_2014 ha evidenciado una adhesión generalizada a los discursos del individualismo y la meritocracia por parte de los jóvenes en la ciudad de Oslo. Los participantes de la investigación señalan que la determinación individual y trabajo duro son fundamentales. No obstante, aunque los jóvenes señalan como central el mérito, esto no impide que reconozcan diferencias de inicio relacionadas a la transmisión de recursos familiares. En esta línea, el trabajo de @irwin_family_2009a ha demostrado la importancia que los jóvenes le dan a los factores individuales para “salir adelante”, aunque también contribuyen con evidencia en torno a la importancia del apoyo emocional que puede brindar la familia. Adicionalmente, una investigación en jóvenes de secundaria en Estados Unidos sugiere que las visiones que tienen los adolescentes respecto a las recompensas provenientes del esfuerzo encuentran mayor apoyo en estudiantes migrantes de segunda generación que detentan mayores expectativas de movilidad social ascendente [@peguero_schools_2015, pág. 33]. Por último, @sun_value_2010 han estudiado si existe una brecha de valores entre generaciones jóvenes y viejas en China, hallando que los más jóvenes tienden a ser más individualistas en sus formas de vida. Estos antecedentes muestran que desde edades tempranas los niños y jóvenes se forman juicios y opiniones acerca de la desigualdad, lo que probablemente tambien aplica para sus visiones sobre la meritocracia.

## El presente estudio: La socialización de la meritocracia por parte de la familia y la escuela

La familia es un primer agente de socialización que provee valores, expectativas y reglas [@martinez_escuela_2015a]. Aunque se ha criticado un sesgo adultocéntrico en los estudios de socialización política al centrarse en el estudio de la transferencia de valores [@andersson_situational_2015], existe contundente evidencia para señalar la importancia de la socialización familiar, donde las creencias parentales ejercen influencia en las creencias, actitudes y comportamientos de los niños [@olivos_motivation_2021; @bandura_selfefficacy_2001; @wigfield_development_2006]. Más aún, los padres crían a sus hijos en función de culturas de clase,  transmitiendo creencias y actitudes estratificadas [@calarco_coached_2014]. De modo coherente, se ha evidenciado que los padres transmiten a sus hijos actitudes cívicas, intenciones de participación, posiciones políticas entre otras características [@muddiman_young_2019; @nesbit_influence_2013a]. En esta línea, la evidencia en torno a la socialización de distintas características subjetivas permite suponer que la transmisión intergeneracional también se expresaría en torno a las percepciones meritocráticas, de modo tal que:

  > Hipótesis 1: Existe una asociación positiva entre el nivel de percepción de meritocracia de los padres y de sus hijos.

Un segundo agente relevante de socialización es la escuela. Más allá de su rol educacional, la escuela contribuye a dar forma a la conducta y las visiones del mundo de los jóvenes estudiantes [@nishiyama_enabling_2019]. En este contexto, la experiencia de justicia de los estudiantes juega un rol fundamental [@resh_sense_2014; @resh_sense_2018] en tanto fomenta la inferencia de ideas respecto a la desigualdad [@mijs_inequality_2018]. Entre los distintos tipos de justicia de la escuela [@resh_justice_2016], se destaca el rol que cumple la sensación de justicia en las notas, la cual es relevante en tanto representa las experiencias de los estudiantes relativas a lo justo o injusto, afectando tanto la formación de la autoimagen, de creación de jerarquías en el aula y su visión del mundo sobre diversos temas [@jasso_exploring_2002]. Los estudios en este ámbito han demostrado que la sensación de justicia en las notas fomenta orientaciones liberales-democráticas [@resh_sense_2014], genera confianza en las instituciones [@resh_sense_2018], y contribuye que los estudiantes apoyen más la asignación meritocrática de las notas [@resh_justice_2009]. Frente a lo anterior, esta investigación propone que la sensación de justicia en las notas también fomenta una mayor percepción de meritocracia por parte de los estudiantes, lo cual es consistente con la evidencia señalada por @olivos_motivation_2021. Dicho lo anterior, se sostiene que

  > Hipótesis 2: Estudiantes con una mayor sensación de justicia en sus notas percibirán mayor meritocracia.

La socialización familiar y escolar de la percepción meritocrática ocurren en conjunto y probablemente se afectan mutuamente. Por ello, proponemos que la asociación de la percepción meritocrática de los padres con  la de sus hijos se verá potenciada si el estudiante siente que sus calificaciones son justas. Inversamente, aunque el estudiante sea socializado en creencias meritocráticas, si él experimenta injusticia en sus notas el efecto de las creencias de sus padres será más débil. Por ello, proponemos como hipótesis que:

  > Hipótesis 3: La relación entre percepción meritocrática de los padres y de los hijos (H1) será más positiva para aquellos que experimentan un mayor sentido de justicia en la escuela (H2).

La evidencia en torno a las creencias meritocráticas destacan el rol que juegan factores asociados a la posición social. @reynolds_perceptions_2014 señala que las personas de mayor estatus en Estados Unidos poseen una mayor percepción de meritocracia que quienes poseen un menor estatus. En la misma línea, @kunovich_systems_2007 da cuenta de evidencia  consistente con un enfoque de interés racional, de modo tal que a mayores ingresos y educación los sujetos poseen mayor preferencia por pago meritocrático. Pese a sus diferencias, los resultados de @solt_economic_2016 y @newman_false_2015  proveen respaldo empírico de la relación positiva entre ingresos y creencias meritocráticas. En base a esta evidencia es posible sostener que padres con mayor nivel socioeconómico poseerán mayor nivel de creencias meritocráticas. En la misma línea, proponemos que estudiantes en escuelas  con mayor nivel socioeconómico tenderán a percibir mayor meritocracia.

  > Hipótesis 4: El estatus socioeconómico de la familia posee un efecto positivo sobre las percepciones meritocráticas del estudiante.

  > Hipótesis 5: El estatus socioeconómico de la escuela posee un efecto positivo sobre las percepciones meritocráticas del estudiante

La Figura \@ref(fig:modelo) muestra un esquema resumen de las hipótesis del estudio:


```{r modelo, echo=FALSE, fig.cap='Hypothesis summary model'}
knitr::include_graphics(path = "input/images/model-hip-eng.PNG")
```

# Metodología

## Datos

```{r n-datos, include=FALSE}
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(dplyr) # librerias
load(file = "input/data/ap_est.RData")
df_reducida <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>%
  na.omit(df_reducida) %>%
  select(perc_trabajo_duro_factor_est,
         perc_esfuerzo_factor_est,
         perc_trabajo_duro_factor_ap,
         perc_esfuerzo_factor_ap,
         sj_direct_factor,
         sj_indirect_ln)

df_completa <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             # perc_trabajo_duro_factor_ap,
                             # perc_esfuerzo_factor_ap,
                             sj_direct_factor,
                             sj_indirect_ln,
                             genero_est,pos_pol_est
                             # rbd_est
                             ) %>% na.omit(df_completa)
```

Los datos provienen de la encuesta Panel de Ciudadanía Escolar (PACES), un estudio sobre socialización política familiar que fue realizado aplicando una encuesta a estudiantes, sus apoderados y sus profesores durante 2019-2021. Este estudio fue desarrollado en el marco del  proyecto FONDECYT N°1181239 "Socialización política y experiencia escolar: el rol de la familia y la escuela" financiado por la Agencia Nacional de Investigación (ANID) del Ministerio de Ciencia y Tecnología chileno. En este artículo utilizamos la primera ola del panel disponible al momento de realizar esta investigación, por lo que este es un estudio transversal. La muestra es representativa de los estudiantes de segundo medio (décimo grado) que asisten a escuelas de la Región Metropolitana y las comunas de Antofagasta, Calama, Talca, Curicó y Linares. En total se seleccionaron 64 escuelas. En cada establecimiento educacional seleccionado se consideró encuestar a un curso completo, sus apoderados y sus docentes de historia, ciencias sociales y/o formación ciudadana. En concreto, se cuenta con los datos de 1635 estudiantes, 744 apoderados y 103 profesores. Los datos de esta ola fueron producidos entre agosto y diciembre del año 2019. 

En primer lugar, para testear la hipótesis sobre a la influencia del sentido de justicia en las notas sobre la percepción de meritocracia de los estudiantes, empleamos una muestra de `r dim(df_completa)[1]` individuos correspondiente a los datos con información completa al interior de 64 escuelas. Luego se empleó una base de datos restringida con `r dim(df_reducida)[1]` casos correspondiente estudiantes con información completa de sus apoderados en 60 escuelas, con el objetivo de poner a prueba las hipótesis de transmisión intergeneracional de la percepción de meritocracia. Posteriormente, empleando este mismo conjunto de datos, se analizó la interacción entre la socialización de la meritocracia y el sentido de justicia en las notas, así como también la influencia del nivel socioeconómico familiar y escolar sobre la percepción de meritocracia de estudiantes.   


El marco muestral utilizado para la selección de los establecimientos fue construido para la definición del universo, desde el Directorio de Establecimientos del Ministerio de Educación del año 2019, considerando todos los colegios de los sectores señalados. La selección fue aleatoria y sistemática, considerando localidad, dependencia administrativa (municipal, subvencionado o particular) y tipo de educación (Humanista científica, técnico profesional o mixto). La metodología de aplicación fue presencial y autoaplicada en el establecimiento para docentes y alumnos, siendo llevada a cabo por un encuestador especialmente entrenado para ello. En el caso de los apoderados fue autoaplicada en sus hogares.

## Variables

En la Tabla \@ref(tab:desc01) se presentan las variables de nivel individual de este estudio. Las preguntas utilizadas corresponden a indicadores de percepción meritocrática que han sido utilizadas en otras investigaciones, en particular aquellas que analizan datos del módulo de desigualdad social del _International Social Survey Programme_ (ISSP) [@reynolds_perceptions_2014]. En este artículo, se midió la percepción meritocrática de los estudiantes a partir de dos indicadores relativos al rol del esfuerzo y el trabajo duro para surgir en la vida. Ambos indicadores corresponden a escalas Likert de cuatro categorías, midiendo grado de importancia y grado de acuerdo, respectivamente. 

```{r include=FALSE, results='asis'}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, summarytools, kableExtra, dplyr, lavaan, haven, htmlwidgets, webshot, sjPlot,sjlabelled) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
)

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Funciones para renderizar tablas tanto en HTML como en pdf
fwidth = if(is_html_output()) { #Usar en argumento "full_width" de kableExtra
  T
} else if(is_latex_output()) {
  F
}

graph.magnif_table = if(is_html_output()) { # Usar en argumento "graph.magnif=" de summarytools
  1.2
} else if(is_latex_output()) {
  0.75
}

width_table = if(is_html_output()) {
  800
} else if(is_latex_output()) { # Usar en "width=" dentro del argumento "image=" en kable
  500
}

# Css
st_css()
st_options(lang = "en",
           footnote = NA,
           bootstrap.css = F,
           custom.css = "input/css/dfsummary.css")

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")

# Seleccionar variables
df_est<- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             sj_direct_factor,
                             sj_indirect_ln,
                             pos_pol_factor_est,
                             genero_factor_est,
                             ) %>% na.omit(basereg) 

df_est$genero_factor_est <- factor(df_est$genero_factor_est,
                                   levels = levels(df_est$genero_factor_est), 
                                   labels = c("Male",
                                              "Female",
                                              "Other"))
sjlabelled::set_label(df_est$genero_factor_est) <- "Student Gender"
df_pad <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>% na.omit(basereg) %>% 
                      select(perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             libros_hogar_factor_ap,
                             quintiles_ingresos_pc_factor,
                             pos_pol_factor_ap,
                             univ)
df_pad$univ <- factor(x = df_pad$univ,
                      levels = c(0,1),
                      labels = c("Parents have universitary degree",
                                 "Parents does not have universitary degree"))
sjlabelled::set_label(df_pad$univ) <- "Parents have universitary degree"

# Df variables nivel 1: estudiantes............................................
df_1_est<- dfSummary(select(df_est,perc_trabajo_duro_factor_est:genero_factor_est),
               plain.ascii = FALSE,
               style = "grid",
               tmp.img.dir = "/tmp",
               graph.magnif = TRUE,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = F,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               col.widths = c(1000,10,10,10,10)
               )
df_1_est$Variable <- NULL # delete variable column

# Df variables nivel 1: apoderados..............................................
df_1_pad<- dfSummary(select(df_pad,perc_trabajo_duro_factor_ap:univ),
               plain.ascii = FALSE,
               style = "grid",
               tmp.img.dir = "/tmp",
               graph.magnif = TRUE,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = F,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               col.widths = c(1000,10,10,10,10)
               )
df_1_pad$Variable <- NULL # delete variable column

# combinar tabla estudiante y apoderados....................
df_est_pad<- rbind(df_1_est,df_1_pad)
df_est_pad<- df_est_pad[c(1,2,7,8,3,4,10,12,9,6,5,11),] # reordenar los niveles
view(df_est_pad,file = "desc01.html") # Ver tabla en un archivo HTML
webshot(url ="desc01.html" ,file ="output/tables/desc01.png") # Remover archivo HTML

# Df variables nivel 2..........................................................
df_rbd <- ap_est %>% select(
  dependencia_factor_est,
  rbd_est,
  nse_grupo
  ) %>%
  na.omit(basereg)

df_n2 <-
df_rbd %>%
  group_by(rbd_est) %>%
  summarise(
    dependencia_factor_est=mean(as.numeric(dependencia_factor_est), na.rm=T),
    nse_grupo=mean(as.numeric(nse_grupo), na.rm=T))

df_n2$dependencia_factor_est <- factor(df_n2$dependencia_factor_est,
                                      levels = 1:3,
                                      labels = c("Public",
                                                 "Private subsidized",
                                                 "Private"))
sjlabelled::set_label(df_n2$dependencia_factor_est) <- "Administration"

df_n2$nse_grupo <- factor(df_n2$nse_grupo,
                          levels = c(1,2,3,4,5),
                          labels = c("Low",
                                     "Middle-low",
                                     "Middle",
                                     "Middle-high",
                                     "High"))
sjlabelled::set_label(df_n2$nse_grupo) <- "School socioeconomic status"

df.esc<- dfSummary(select(df_n2,
                          dependencia_factor_est,
                          nse_grupo),
               plain.ascii = FALSE,
               style = "grid",
               tmp.img.dir = "/tmp",
               graph.magnif = 0.75,
               headings = F,  # encabezado
               varnumbers = F, # num variable
               labels.col = T, # etiquetas
               na.col = F,    # missing
               graph.col = T, # plot
               valid.col = T, # n valido
               # col.widths = c(1000,10,10,10,10)
               )
df.esc$Variable <- NULL # delete variable column
view(df.esc,file = "desc01_esc.html") # Ver tabla en un archivo HTML
webshot(url ="desc01_esc.html" ,file ="output/tables/desc01_esc.png",vheight = 10) # Foto al documento HTML para guardar en png
file.remove(c("desc01.html","desc01_esc.html")) # Remover archivo HTML
```

```{r desc01, echo=FALSE, results='asis'}
knitr::kable(data.frame(image='![](output/tables/desc01.png){height=80%}'),    # generar tabla
             caption="Student variables",
             col.names = "",
             row.names = F,
             format = "pandoc") %>%  kable_styling(latex_options = c("HOLD_position"),full_width = fwidth)
```

Las variables independientes de nivel individual se dividieron de acuerdo a si corresponden a padres o estudiantes. En el caso de los padres, existen dos variables relevantes: percepción de meritocracia y estatus socioeconómico. Para la percepción de meritocracia se les preguntó lo mismo que a los estudiantes, pero para simplificar el modelamiento en la variable de apoderados  se procedió a agrupar las categorías ''Muy importante',  'Importante' y 'Algo importante' para la variable de Importancia del trabajo duro. Igualmente, para la afirmación respecto a que en Chile quienes se esfuerzan salen adelante, se agruparon las categorías 'De acuerdo' con 'Muy de acuerdo' y 'Desacuerdo' con 'Muy en desacuerdo', respectivamente.

En el caso del estatus socioeconómico, se utilizaron los ingresos del hogar y el nivel educacional de los apoderados como indicadores. Se construyeron quintiles a partir del indicador original de 11 tramos de ingresos declarados por los padres. En el caso del nivel educacional de los apoderados original, se creó una variable dummy donde 1 es "Padres tienen título universitario" y 0 es "Padres no tienen título universitario".  

La variable de justicia en las notas es clave para nuestro estudio, ya que representa la experiencia escolar de justicia. Se emplearon dos formas de medir el sentido de justicia en las notas: directa e indirecta. La forma directa se corresponde a una pregunta sobre si las notas que se obtienen son merecidas, mientras la indirecta es un indicador numérico construido a partir de la fórmula propuesta por @jasso_new_1980. Esta fórmula corresponde la proporción entre la recompensa obtenida y la recompensa justa, a la cual se le aplica un término logarítmico. Por lo tanto en el caso de justicia absoluta (nota obtenida=nota merecida) el valor del término será cero (Log 1=0), menor a cero en caso de justicia por sub-recompensa, y mayor a cero en caso de justicia por sobre recompensa. Siguiendo las aplicaciones hechas al ámbito educativo por parte de @resh_sense_2014, @resh_sense_2017, @resh_sense_2018, se utilizaron las notas reportadas por los estudiantes como la recompensa que se distribuye en la escuela. La fórmula aplicada a los datos del artículo se pueden ver en la Ecuación \@ref(eq:jef).

\begin{equation}
   \text{Sentido de justicia en notas}= ln(\frac{\text{nota obtenida}}{\text{nota justa}}) (\#eq:jef)
\end{equation}


```{r desc01-esc, echo=FALSE, results='asis'}
knitr::kable(data.frame(image='![](output/tables/desc01_esc.png){height=20%}'), # generar tabla
             caption="School variables",
             col.names = "",
             row.names = F,
             format = "pandoc") %>%
  kable_styling(latex_options = c("HOLD_position"),
                full_width = fwidth)
```

En la Tabla \@ref(tab:desc01-esc) se muestra el nivel socioeconómico de la escuela, la principal variable independiente a nivel contextual. Esta variable proviene de datos administrativos del Ministerio de Educación y corresponde a una clasificación en cinco grupos socioeconómicos. Para su elaboración, se consideran cuatro variables: 1) Nivel educacional de la Madre, 2) Nivel Educacional del Padre, 3) Ingreso económico total mensual en el hogar y 4) el Índice de Vulnerabilidad. Las tres primeras variables provienen del cuestionario de apoderados del Sistema Nacional de Evaluación de Resultados de Aprendizaje (SIMCE); y la cuarta es aportada por la Junta Nacional de Auxilio Escolar y Becas (JUNAEB) [@mineduc_metodologia_2013]

Las variables control incluyeron sexo del estudiante, posición política de padres y estudiantes, ciudad, dependencia administrativa de la escuela y cantidad de libros en el hogar.

## Métodos

Debido a que la muestra posee una estructura jerárquica (estudiantes anidados en escuelas), se estimaron regresiones multinivel para contrastar las hipótesis siguiendo los pasos recomendados para estimar y reportar este tipo de modelos [@aguinis_bestpractice_2013a]. Dado que los dos indicadores de percepción de meritocracia de estudiantes son variables ordinales, se trabajó con modelos multinivel para variables de este tipo [@arfan_ordinal_2017a][^2]. El análisis se llevó a cabo con el software estadístico `R` versión 4.0.3 "Bunny-Wunnies Freak Out".

[^2]: En modelos ordinales multinivel la variable dependiente representa el cálculo de la probabilidad acumulada de que un estudiante responda hasta $C$ en los indicadores de percepción de meritocracia, siendo $Y_{cij}$ una respuesta categórica ordenada de un estudiante $i^{th}$ en una escuela (cluster) $j^{th}$ con $C$ categorías ordenadas, codificadas como $C = 1,2,3,4$. Esta probabilidad se calcula en función de: el intercepto por cada categoría $a_c$, los coeficientes $\gamma_1$ y $\gamma_2$ para la percepción de meritocracia de los padres y el sentido de justicia en las notas respectivamente, $\gamma_n$ para las variables de control, $u_{0j}$ como término de error para una escuela $j$ y $e_{ij}$ como error de la estimación para el individuo $i$ en una escuela $j$. Para la estimación se utilizará la librería `clmm2` de R.

Los análisis se basarán en las hipótesis que han sido pre-registradas y se pueden acceder en <https://osf.io/fazdx>.


# Resultados


<!-- [AQUI likertplot meritocracia padre hijos] -->

```{r likert, echo=FALSE, fig.cap='Student and parents Perceived Meritocracy items'}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(dplyr, haven, sjPlot,ggplot2) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")

# Seleccionar variables para el análisis
base_lik <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>% na.omit(base_lik) %>%
  select(perc_trabajo_duro_factor_est,
         perc_trabajo_duro_factor_ap,
         perc_esfuerzo_factor_est,
         perc_esfuerzo_factor_ap
         )

  # update.packages("sjPlot") # please install version 2.8.9 or above
  ggplot2::theme_set(ggplot2::theme(panel.background = ggplot2::element_rect(fill = "gray85",
                                                                             colour = "gray85"),
                                    panel.border = ggplot2::element_blank(),
                                    axis.text.y = ggplot2::element_text(size = 13,
                                                                        hjust = 1),
                                    title = ggplot2::element_text(size = 13,
                                                                  face = "bold"),
                                    legend.text = ggplot2::element_text(size = 12),
                                    plot.caption = ggplot2::element_text(size = 10,
                                                                         face = "plain",
                                                                         hjust = 1)))
  #Plot : Perception of meritocracy student and family
  p1<-
    base_lik %>%
    select(perc_trabajo_duro_factor_est,
           perc_trabajo_duro_factor_ap) %>%
    sjPlot::plot_likert(geom.colors = "PuBu",
                        geom.size = 0.8,
                        catcount = 4,
                        grid.range  =  c (1.2 , 1.2),
                        values  =  "sum.outside",
                        reverse.colors = T,
                        reverse.scale = T,
                        show.n = FALSE) +
    theme(legend.position="bottom")

    p2<-
    base_lik %>%
    select(perc_esfuerzo_factor_est,
           perc_esfuerzo_factor_ap) %>%
    sjPlot::plot_likert(geom.colors = "PuBu",
                        geom.size = 0.8,
                        catcount = 4,
                        grid.range  =  c (1.2 , 1.2),
                        values  =  "sum.outside",
                        reverse.colors = T,
                        reverse.scale = T,
                        show.n = FALSE) +
    theme(legend.position="bottom") +
    labs(caption =
           paste0("Source: Authors calculations based on PACES Study"," (n=",dim(na.omit(base_lik))[1],")"))

  sjPlot::plot_grid(list(p1,p2),tags = c("",""))
```

La Figura \@ref(fig:likert) permite comparar la distribución de las variables de percepción de meritocracia de estudiantes y apoderados. Los resultados dan cuenta de que en general existe una alta percepción de meritocracia, tanto en estudiantes como en apoderados en ambas mediciones. Por un lado, la importancia que se atribuye al trabajo duro en estudiantes concentra aproximadamente un 86% de las respuestas en las categorías "Importante" y "Muy importante" siendo un 82% en apoderados. Adicionalmente, el panel inferior muestra frente a la afirmación de que en Chile las personas que se esfuerzan salen adelante, se puede observar una distribución similar en las respuestas de la variable del panel superior, concentrando un 81% de respuestas de estudiantes en las categorías "De acuerdo" y "Muy deacuerdo" y un 82% en el caso de las respuestas de sus apoderados. En conjunto, se puede afirmar que estos resultados van en línea con lo planteado en las hipótesis, es decir, que las respuestas de estudiantes tienden a distribuirse similar con respecto a las de los apoderados.

<!-- [AQUI densidad de SJ indirecto] -->

```{r dens-sjust, echo=FALSE, fig.cap='Distribution of average deserved and obtained grades'}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, haven, texreg, sjPlot, lme4, ordinal, webshot,ggplot2) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")


# Seleccionar variables para el análisis
base_sj <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ,prom_obt,prom_mer
                             ) %>% na.omit(base_sj) %>%
  select(prom_obt,
         prom_mer
         )

  # update.packages("sjPlot") # please install version 2.8.9 or above
  ggplot2::theme_set(ggplot2::theme(panel.background = ggplot2::element_rect(fill = "gray85",
                                                                             colour = "gray85"),
                                    panel.border = ggplot2::element_blank(),
                                    axis.text.y = ggplot2::element_text(size = 13,
                                                                        hjust = 1),
                                    title = ggplot2::element_text(size = 13,
                                                                  face = "bold"),
                                    legend.text = ggplot2::element_text(size = 12),
                                    plot.caption = ggplot2::element_text(size = 10,
                                                                         face = "plain",
                                                                         hjust = 1)))
a <- data.frame(base_sj$prom_obt);
a$grupo <- "Obtained"
names(a) <- c("promedio","Grade")
b <- data.frame(base_sj$prom_mer)
b$grupo <- "Deserved"
names(b) <- c("promedio","Grade")
df_notas<- rbind(b,a)

  ggplot(df_notas) +
  geom_density(aes(x=promedio,fill=Grade), alpha=0.4) +
  scale_x_continuous(name = "Grade average",
                     breaks=1:7,
                     labels = as.character(1:7)) +
  ylab("Density")+
  theme(legend.position="bottom") +
    labs(caption =
           paste0("Authors calculations based on PACES Study"," (n=",dim(na.omit(base_sj))[1],")"))
```

La Figura \@ref(fig:dens-sjust) muestra la distribución de las variables correspondientes al promedio notas obtenido y merecido que los estudiantes declararon. Por un lado, se observa que la distribución de la nota obtenida posee una media (_M_ = 5.82) más baja que la nota merecida (_M_ = 6.01). Por otro lado, al comparar las distribuciones, se puede observar que la nota obtenida se encuentra menos dispersa (_DS_ = 0.58) que la nota merecida (_DS_ = 0.64). Este resultado da luces de una proporción mayoritaria de estudiantes muestran consistencia respecto a la nota que declaran obtener y merecer. Sin embargo, es posible identificar discordancias en torno a la asignación de las notas, es decir, existe un grupo de estudiantes que pueden ser considerados como “subrecomensados” y otros como “sobrerecomensados,” lo cual en última instancia se busca medir a través de la variable de sentido de justicia indirecto.

En la Figura \@ref(fig:correl) se presentan las correlaciones entre las variables principales del estudio. Las correlaciones deben interpretarse como asociaciones positivas o negativas según el signo y de mayor intensidad según se acerque el valor absoluto a 1. Para el caso de las correlaciones entre percepción de meritocracia de estudiantes y sentido de justicia en las notas, se ha empleado una muestra que considera únicamente las respuestas válidas de estudiantes (_n_ = `r dim(df_completa)[1]`), mientras que las correlaciones con la percepción de meritocracia de apoderados se emplea una muestra acotada a los casos válidos de estudiantes que poseen información de sus apoderados (_n_ = `r dim(df_reducida)[1]`)

```{r correl, echo=FALSE, fig.cap="Pearson's correlation matrix for perception of meritocracy and sense of justice in grades"}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, haven, sjlabelled, rvest) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Funciones para renderizar tablas tanto en HTML como en pdf
table_format = if(is_html_output()) { # Usar en argumento "format=" de kable
  "html"
} else if(is_latex_output()) {
  "latex"
}

fwidth = if(is_html_output()) { #Usar en argumento "full_width" de kableExtra
  T
} else if(is_latex_output()) {
  F
}

stars.pval2=function (p.value) # Usar en correlaciones policloricas
 {
    unclass(symnum(p.value, corr = FALSE, na = FALSE, cutpoints = c(0,
        0.001, 0.01, 0.05, 1), symbols = c("***",
        "**", "*", " ")))
}

# Cargar base de datos
load(file = "input/data/ap_est.RData")

# Seleccionar variables a introducir en el análisis
df_completa <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             # perc_trabajo_duro_factor_ap,
                             # perc_esfuerzo_factor_ap,
                             sj_direct,
                             sj_indirect_ln,
                             genero_est,pos_pol_est
                             # rbd_est
                             ) %>% na.omit(df_completa) %>%
  mutate(perc_trabajo_duro_factor_est=as.numeric(perc_trabajo_duro_factor_est),
         perc_esfuerzo_factor_est = as.numeric(perc_esfuerzo_factor_est),
         perc_trabajo_duro_factor_ap=1,
         perc_esfuerzo_factor_ap=1,
         sj_direct=as.numeric(sj_direct),
         sj_indirect_ln=as.numeric(sj_indirect_ln)) %>%
  select(perc_trabajo_duro_factor_est,
         perc_esfuerzo_factor_est,
         perc_trabajo_duro_factor_ap,
         perc_esfuerzo_factor_ap,
         sj_direct,
         sj_indirect_ln,
         -genero_est,-pos_pol_est
         )

# sjPlot::tab_corr(df_completa[,c("perc_trabajo_duro_factor_est",
#                                 "perc_esfuerzo_factor_est",
#                                 "sj_direct","sj_indirect_ln")],)

cor_1 <- cor(df_completa) %>% data.frame()

df_reducida <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>% na.omit(df_reducida) %>% 
  select(perc_trabajo_duro_factor_est,
         perc_esfuerzo_factor_est,
         perc_trabajo_duro_factor_ap,
         perc_esfuerzo_factor_ap,
         sj_direct,
         sj_indirect_ln)



df_reducida<- data.frame(lapply(df_reducida[,c("perc_trabajo_duro_factor_est",
                                       "perc_esfuerzo_factor_est",
                                       "perc_trabajo_duro_factor_ap",
                                       "perc_esfuerzo_factor_ap",
                                       "sj_direct",
                                       "sj_indirect_ln")], function(x) as.numeric(x)))

# sjPlot::tab_corr(df_reducida[,c("perc_trabajo_duro_factor_est",
#                                 "perc_esfuerzo_factor_est",
#                                    "perc_trabajo_duro_factor_ap",
#                                    "perc_esfuerzo_factor_ap",
#                                 "sj_direct","sj_indirect_ln")],)

cor_2 <- cor(df_reducida) %>% data.frame()

cor_3 <- cor_1
cor_3$perc_esfuerzo_factor_est <- ifelse(test = cor_3$perc_esfuerzo_factor_est,
                yes = cor_2$perc_esfuerzo_factor_est,
                no = cor_3$perc_esfuerzo_factor_est
                  )

for (i in names(cor_3)) {
cor_3[,i] <-  ifelse(test = is.na(cor_3[,i]),
                 yes = cor_2[,i],
                 no = cor_3[,i]
                 )
}

cor_3 <- as.matrix(cor_3)

  diag(cor_3) = NA #set diagonal values to NA
  # Set Row names of the matrix
  rownames(cor_3) <- c("A. Importance of hard work (student)",
                       "B. Effort to get ahead (student)",
                       "C. Importance of hard work (parents)",
                       "D. Effort to get ahead (parents)",
                       "E. Sense of Justice in grades (direct)",
                       "F. Sense of Justice in grades (indirect)")
  #set Column names of the matrix
  colnames(cor_3) <-c("(A)", "(B)","(C)","(D)","(E)","(F)")
  #Plot the matrix using corrplot
  corrplot::corrplot(cor_3,
    method = "color",
    addCoef.col = "#000390",
    type = "upper",
    tl.col = "black",
    col=colorRampPalette(c("white","#0068DC"))(12),
    bg = "white",
    na.label = "-")
```


Por un lado, para la muestra restringida (_n_ = `r dim(df_reducida)[1]`), la matriz de correlaciones muestra que existe una asociación positiva y estadísticamente significativa entre el nivel de importancia atribuida al trabajo duro de apoderados con la de sus hijos (_r_= 0.09, _p_ < 0.05) . Por otro lado, el respaldo de apoderados a la afirmación sobre que en Chile los esfuerzos son recompensados no está asociado significativamente con ninguna variable de los estudiantes. Adicionalmente, se puede observar una relación positiva y significativa (_r_= 0.09, _p_ < 0.05) entre la importancia del trabajo duro de estudiantes y el acuerdo con que en Chile quienes se esfuerzan salen adelante de apoderados.

Respecto de las variables de sentido de justicia directo e indirecto de estudiantes (_n_ = `r dim(df_completa)[1]`), en general las asociaciones son positivas pero ninguna de las medidas muestra una asociación significativa con la importancia del trabajo duro y el nivel de acuerdo con la afirmación sobre que en Chile los esfuerzos son recompensados de estudiantes.

<!-- El sentido de justicia directo se relaciona de manera positiva y no significativa con la importancia del trabajo duro de estudiantes (_r_ = 0.03; _p_ > 0.05; _n_ = 1415), así también muestra una relación en el mismo sentido y no significativa con la afirmación de que en Chile quienes se esfuerzan salen adelante (_r_ = 0.04; _p_ > 0.05; _n_ = 1415).  -->

<!-- En la misma línea, el sentido de justicia indirecto muestra una relación positiva y no significativa con la importancia del trabajo duro de estudiantes (_r_ = 0.05; _p_ > 0.05; _n_ = 1415), mientras que con el apoyo a la afirmación de que en Chile quienes se esfuerzan salen adelante tiene una relación negativa y no significativa (_r_ = -0.01; _p_ > 0.05; _n_ = 1415).  -->

## Análisis multivariado

La Tabla \@ref(tab:getah) presenta los resultados de la estimación del modelo de regresión ordinal multinivel para la variable de “importancia atribuida al trabajo duro para salir adelante” como indicador de percepción meritocrática en estudiantes. Las estimaciones de los modelos siguen un orden de complejidad ascendente con tal de poder analizar el comportamiento de los coeficientes en la medida que son controlados por otros predictores. Bajo esta lógica, primero se estiman modelos simples para las variables principales, luego modelos multivariados, y finalmente se introducen controles e interacciones.

```{r getah, echo=FALSE, cache=TRUE, results='asis'}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, haven, texreg, sjPlot, lme4, ordinal, webshot) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")

# Seleccionar variables para el análisis
basereg <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>% na.omit(basereg)

basereg_est <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             sj_direct_factor,
                             sj_indirect_ln_cwc,
                             sj_indirect_ln,
                             # sj_indirect_cat,
                             # sj_indirect_qtil,
                             genero_est, pos_pol_est,
                             rbd_est
                             ) %>% na.omit(basereg)
# dim(basereg_est)


omit_coef="(Intercept)|(libros_hogar_factor_ap)|(pos_pol_factor_ap)|(pos_pol_factor_est)|(genero_factor_est)|(dependencia_factor_ap)"
con <-c(
  "quintiles_ingresos_pc_factor",
  "libros_hogar_factor_ap",
  "univ",
  "pos_pol_factor_ap",
  "pos_pol_factor_est",
  "genero_factor_est",
  "dependencia_factor_ap"
  ) # Omitir coeficientes en la visualización

ref <- "(1|rbd_est)" # Cluster

cap1 <- "Multilevel ordinal logit models for Socialization of the Importance of Hard Work" # Título tabla
# Modelos

# N de estudiantes
getah.or0.1 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("sj_indirect_ln",ref),collapse="+"))), basereg_est)
getah.or0.2 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("sj_direct_factor",ref),collapse="+"))), basereg_est)
getah.or0.3 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("sj_indirect_ln","sj_direct_factor",ref),collapse="+"))), basereg_est)

# texreg::knitreg(l=list(getah.or0.1,getah.or0.2,getah.or0.3),
#                 include.thresholds=FALSE)

# N de estudiantes y apoderados
# getah.or1 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("perc_tduro_bi_ap",ref),collapse="+"))), basereg)
# getah.or2 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("sj_indirect_ln",ref),collapse="+"))), basereg)
# getah.or3 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("sj_direct_factor",ref),collapse="+"))), basereg)
# getah.or4 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("perc_tduro_bi_ap","sj_indirect_ln","sj_direct_factor",ref),collapse="+"))), basereg)
# getah.or5 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("perc_tduro_bi_ap","sj_indirect_ln","sj_direct_factor",con[-3],ref),collapse="+"))), basereg)
getah.or6 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("perc_tduro_bi_ap","sj_indirect_ln","sj_direct_factor",con,ref),collapse="+"))), basereg, nAGQ = 10)
# getah.or7 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("perc_tduro_bi_ap","sj_indirect_ln","sj_direct_factor", con, "perc_tduro_bi_ap*sj_direct_factor",ref),collapse="+"))), basereg)
getah.or8 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("perc_tduro_bi_ap","sj_indirect_ln","sj_direct_factor", con, "perc_tduro_bi_ap*sj_direct_factor","nse_grupo",ref),collapse="+"))), basereg)

coef_names <- c(
  "Sense of Justice in grades - Indirect (ln)",
  "Less than I deserve",
  "More than I deserve ",
  "Hard work is important¹",
  "Quintile 2","Quintile 3","Quintile 4","Quintile 5","Quintile Don't know/No Answer",
  "Parents have universitary degree (ref: does not have)",
  "School Socio-economic status",
  "Hard work is important x Less than I deserve",
  "Hard work is important x More than I deserve"
  ) # Nombre coeficientes

# knitreg(list(getah.or0.1,getah.or0.2,getah.or0.3,
#              # getah.or1,
#              getah.or6,
#              # getah.or7,
#              getah.or8),
#         omit.coef=omit_coef,
#         include.thresholds=FALSE
#         )

# Renderizar tabla
knitreg(list(getah.or0.1,getah.or0.2,getah.or0.3,
             # getah.or1,
             getah.or6,
             # getah.or7,
             getah.or8),
        caption = paste("(\\#tab:getah)",cap1),
        caption.above=TRUE,
        omit.coef=omit_coef,
        include.thresholds=FALSE,
        custom.gof.rows=list(Controls=c("No","No","No",
                                        # "No",
                                        # "Yes",
                                        "Yes","Yes")),
        groups=list("Sense of Justice in grades - Direct (ref: The ones I deserve)"=2:3,
                    "Parental Perc. Meritocracy (ref: Not important)"=4,
                    "Household income (ref: Quintile 1)"=5:9,
                    "Interaction: Parental Perc. Meritocracy x SJ in grades - Direct" = 12:13),
        custom.coef.names=coef_names,
        scalebox = 0.75,
        threeparttable = T,
        custom.note="\\item *** p < 0.001; ** p < 0.01; * p < 0.05; \\item ¹Note: the perception of parent’s meritocracy was collapsed into dummies, where the category 'It is important' (1) includes the categories 'Very important', 'Important' and 'Somewhat important' and the reference category 'Not important' (0) corresponds to the category 'Not at all important'."
        #file = "output/tables/trabajoduro_ppt.html"
        )
#webshot::webshot("output/tables/trabajoduro_ppt.html","output/tables/trabajoduro_ppt.png")
```

<!-- [SUBIR TABLA DE RECOMENSA AQUI] -->

<!-- - PROBAR LA RESTA EN SJ INDIRECTO -->

En el caso de la hipótesis de transmisión intergeneracional se observa un efecto significativo entre las percepciones meritocráticas de los padres y las percepciones meritocráticas de los estudiantes, relación que es significativa incluyendo controles estadísticos (Model 4 : *logit* = 1.21; *p* \< 0.01). 

Respecto a la hipótesis del sentido de justicia en la escuela, se puede observar que en ninguna de las formas en que se mide la sensación de justicia en las notas permite concluir una relación positiva con la percepción meritocrática de los estudiantes. Sin embargo, es posible evidenciar un efecto del nivel socioeconómico en las percepciones meritocráticas de los estudiantes. En comparación con el primer quintil, los estudiantes de los tres quintiles superiores poseen más probabilidades de indicar que el trabajo duro es importante para surgir en la vida, aunque solo el efecto del tercer quintil perdura en las especificaciones que consideran la interacción entre la percepción de meritocracia de los padres con el sentido de justicia en las notas directo (ver *logit* Modelos 4 y 5 con *p* \< 0.05). Esta evidencia es consistente con los antecedentes que señalan la importancia del nivel socioeconómico al explicar las percepciones meritocráticas, a la vez que aporta evidencia para señalar que dicha asociación, evaluada comúnmente en adultos, es aplicable a los jóvenes. Adicionalmente,  se encuentra un efecto significativo del nivel socioeconómico (Modelo 5: *logit* = 0.27, *p* \< 0.05) de la escuela. En suma, los hallazgos confirman la relación positiva del nivel socioeconómico con la percepción meritocrática a nivel individual, como también al nivel escuela.

Respecto a las interacciones, se observa que, aunque la justicia en las notas no tenga un efecto en sí misma, si posee una interacción significativa con la percepción meritocrática de los padres. Esto va en la línea de lo hipotetizado, en tanto se esperaba que la experiencia escolar de injusticia pudiera debilitar la asociación entre la percepción meritocrática de los padres y los estudiantes. Efectivamente, como se puede observar en la Figura \@ref(fig:interac), la relación positiva entre creencias meritocráticas entre padres e hijos se ve atenuada (disminuye) en el caso de que se perciba ser sub-recompensado con notas en la escuela. Por lo tanto, la escuela parece jugar un rol relevante como agente socializador, pudiendo incluso interferir con aspectos de socialización familiar.


```{r interac, fig.width=11, fig.height=6, fig.cap="Interaction between parental, student and meritocratic perceptions and justice in grades", echo=FALSE, out.width='100%'}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, haven, texreg, sjPlot, lme4, ordinal, ggplot2) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")

# Seleccionar variables
basereg <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>% na.omit(basereg)

omit_coef="(Intercept)|(libros_hogar_factor_ap)|(pos_pol_factor_ap)|(pos_pol_factor_est)|(genero_factor_est)|(dependencia_factor_ap)"
con <-c(
  "quintiles_ingresos_pc_factor",
  "libros_hogar_factor_ap",
  "educ_factor_ap",
  "pos_pol_factor_ap",
  "pos_pol_factor_est",
  "genero_factor_est",
  "dependencia_factor_ap"
  ) # Omitir coeficientes dela visualización
ref <- "(1|rbd_est)"


# Elaborar modelo de interacción
getah.or7 <- ordinal::clmm(formula(paste("perc_trabajo_duro_factor_est~",paste(c("perc_tduro_bi_ap","sj_indirect_noln","sj_direct_factor", con, "perc_tduro_bi_ap*sj_direct_factor",ref),collapse="+"))), basereg)

# Preparar datos para gráfico
basereg$fitted_or7 <- getah.or7$fitted.values
pred_or7<- basereg %>%
  dplyr::mutate(sj_direct_factor=relevel(sj_direct_factor,ref = "Less than I deserve")) %>%
  dplyr::group_by(perc_trabajo_duro_factor_est,perc_tduro_bi_ap,sj_direct_factor) %>%
  dplyr::summarise(yhat=mean(fitted_or7))

# Elaborar gráfico interacción
graph_interact <- ggplot2::ggplot(data=pred_or7, aes(x=perc_tduro_bi_ap, y=yhat,
                          group=sj_direct_factor,
                          color=sj_direct_factor,
                         # fill=sj_direct_factor
                         )) +
  geom_point() +
  geom_line()+
  scale_x_discrete(labels = c("Not important", "Important")) + 
  facet_grid(~perc_trabajo_duro_factor_est) +
  xlab("Importance of hard work (parents)") +
  ylab("Probability") +
  scale_color_discrete("Justice in grades - Direct") +
  theme(legend.position="bottom")

graph_interact
```


```{r effort, echo=FALSE, results='asis', cache = T}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, haven, texreg, sjPlot, lme4, ordinal, webshot) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")

# Seleccionar variables
basereg <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>% na.omit(basereg)


basereg_est <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             sj_direct_factor,
                             sj_indirect_ln_cwc,
                             sj_indirect_ln,
                             # sj_indirect_cat,
                             # sj_indirect_qtil,
                             genero_est, pos_pol_est,                             
                             rbd_est
                             ) %>% na.omit(basereg)


omit_coef="(Intercept)|(libros_hogar_factor_ap)|(pos_pol_factor_ap)|(pos_pol_factor_est)|(genero_factor_est)|(dependencia_factor_ap)"
con <-c(
  "quintiles_ingresos_pc_factor",
  "libros_hogar_factor_ap",
  "univ",
  "pos_pol_factor_ap",
  "pos_pol_factor_est",
  "genero_factor_est",
  "dependencia_factor_ap"
  ) # Omitir coeficientes de la visualización

ref <- "(1|rbd_est)" #Cluster

cap1 <- "Multilevel ordinal logit models for Socialization of Effort is rewarded" # Título tabla

# Elaboración modelos

# N de estudiantes
effort.or0.1 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("sj_indirect_ln",ref),collapse="+"))), basereg_est)
effort.or0.2 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("sj_direct_factor",ref),collapse="+"))), basereg_est)
effort.or0.3 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("sj_indirect_ln","sj_direct_factor",ref),collapse="+"))), basereg_est)

# texreg::knitreg(l=list(effort.or0.1,effort.or0.2,effort.or0.3),
#                 include.thresholds=FALSE)

# N de estudiantes y apoderados
effort.or1 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("perc_esfuerzo_bi_ap",ref),collapse="+"))), basereg)
# effort.or2 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("sj_indirect_ln",ref),collapse="+"))), basereg)
# effort.or3 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("sj_direct_factor",ref),collapse="+"))), basereg)
# effort.or4 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("perc_esfuerzo_bi_ap","sj_indirect_ln","sj_direct_factor",ref),collapse="+"))), basereg)
# effort.or5 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("perc_esfuerzo_bi_ap","sj_indirect_ln","sj_direct_factor",con,ref),collapse="+"))), basereg)
effort.or6 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("perc_esfuerzo_bi_ap","sj_indirect_ln","sj_direct_factor", con,ref),collapse="+"))), basereg)
effort.or7 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("perc_esfuerzo_bi_ap","sj_indirect_ln","sj_direct_factor", con, "perc_esfuerzo_bi_ap*sj_direct_factor",ref),collapse="+"))), basereg)

effort.or8 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("perc_esfuerzo_bi_ap","sj_indirect_ln","sj_direct_factor", con, "perc_esfuerzo_bi_ap*sj_direct_factor","nse_grupo",ref),collapse="+"))), basereg)

coef_names <- c(
  "Sense of Justice in grades - Indirect (ln)",
  "Less than I deserve",
  "More than I deserve ",
  "Effort is rewarded¹",
  "Quintile 2",
  "Quintile 3",
  "Quintile 4",
  "Quintile 5",
  "Quintile Don't know/No Answer",
  "Parents have universitary degree (ref: does not have)",
  "School Socio-economic status",
  "Effort is rewarded x Less than I deserve",
  "Effort is rewarded x More than I deserve"
  ) # Nombre coeficientes

# knitreg(list(effort.or0.1,effort.or0.2,effort.or0.3,
#              effort.or1,
#              effort.or6,
#              # effort.or7,
#              effort.or8),
#         omit.coef=omit_coef,
#         include.thresholds=FALSE
#         )

# Renderizar
texreg::knitreg(list(effort.or0.1,effort.or0.2,effort.or0.3,
                     # effort.or1,
                     effort.or6,
                     # effort.or7,
                     effort.or8),
        caption = paste("(\\#tab:effort)",cap1),
        caption.above=TRUE,
        omit.coef=omit_coef,
        include.thresholds=FALSE,
        custom.gof.rows=list(Controls=c("No","No","No",
                                        # "No",
                                        # "Yes",
                                        "Yes","Yes")),
        groups=list("Sense of Justice in grades - Direct (ref: The ones I deserve)"=2:3,
                    "Parental Perc. Meritocracy (ref: Effort is not rewarded)"=4,
                    "Household income (ref: Quintile 1)"=5:9,
                    "Interaction: Parental Perc. Meritocracy x SJ in grades - Direct" = 12:13),
        custom.coef.names=coef_names,
        # reorder.coef = c(1:10,12,13,11),
        scalebox = 0.75,
        threeparttable = T,
        custom.note="\\item *** p < 0.001; ** p < 0.01; * p < 0.05; \\item ¹Note: the perception of parent’s meritocracy was collapsed into dummies, where the category 'Effort is rewarded' (1) includes the categories 'Agree' and 'Strongly Agree' and the reference category 'Is not rewarded' (0) corresponds to the categories 'Disagree' and 'Strongly Disagree'."
)
```

Adicionalmente a la percepción de meritocracia a través de la importancia atribuida al trabajo duro, la Tabla \@ref(tab:effort) ilustra los resultados de la socialización familiar respecto de la afirmación sobre que en Chile las personas que se esfuerzan salen adelante. En este sentido, respecto a la hipótesis de transmisión intergeneracional de la percepción de meritocracia, los resultados del Modelo 4 muestran que el efecto posee sentido negativo, es decir, contraria a lo establecido en las hipótesis y a los resultados presentados anteriormente respecto a la importancia del trabajo duro para salir adelante. No obstante, el efecto no logra ser estadísticamente significativo (_p_ \> 0.05).

Respecto de la hipótesis en torno al sentido de justicia en las notas, por un lado,  podemos observar que la medición indirecta no posee una asociación significativa con la percepción de meritocracia de estudiantes  (Model 4: *logit* = 0.70, p = \> 0.05). Por otro lado, los Modelos 1, 2 y 3, estimados con la muestra con casos válidos de estudiantes (_n_ =  `r dim(df_completa)[1]`), muestran una relación estadísticamente significativa para el Sentido de Justicia en las notas directo, donde aquellos estudiantes que declaran obtener notas menores a las que merecen, perciben menos meritocracia respecto de aquellos que consideran obtener las notas que merecen (Model 3: *logit* = -0.27, _p_ \< 0.05). Esto quiere decir que estudiantes que sienten que han recibido una calificación que no se condice con sus esfuerzos, tienden a percibir menor meritocracia respecto a quienes que sienten haber sido calificados de manera justa. No obstante, al emplear la muestra restringida para los casos válidos de estudiantes que poseen información de sus padres, el efecto mantiene su dirección pero pierde significancia (Model 4: *logit* = -0.38, _p_ \> 0.05)

Respecto de la hipótesis sobre el nivel socioeconómico, los resultados muestran que el ingreso del hogar se asocia de manera negativa y significativa en el Quintil 4 respecto al Quintil 1 (Model 4: *logit* = -0.75, p \< 0.05). Estos resultados deben ser interpretados con cautela, primero debido a que la asociación es negativa y contraria a lo evidenciado respecto a los resultados en torno a la variable que mide la importancia del trabajo duro, como también por la ausencia diferencias significativas en quintiles inferiores y superiores. En una línea similar, se observa que el nivel socioeconómico de la escuela se asocia en sentido negativo y no significativo con la percepción de los estudiantes frente a la afirmación de que en Chile quienes se esfuerzan salen adelante (Model 5: *logit* = -0.12, p \> 0.05). Estos resultados sugieren que estudiantes pertenecientes a familias de quintiles superiores, la percepción de meritocracia sería más baja respecto al quintil inferior en torno a la afirmación de que en Chile quienes se esfuerzan salen adelante.    

Respecto a la hipótesis de interacción, los resultados permiten afirmar que la experiencia de justicia en las notas modera el la relación de la percepción de meritocracia de apoderados con la de estudiantes, no obstante, estos resultados deben ser interpretados con atención dado que el sentido de la asociación contradice los resultados del análisis de la variable sobre la importancia del trabajo duro. Primero, el Modelo 5 muestra que el efecto de la percepción de meritocracia de los padres mantiene el sentido negativo pero se vuelve estadísticamente significativa (*logit* = -0.65, p \< 0.01) al incorporar el término de interacción, esto significa que para padres que consideran estar de acuerdo con que en Chile las personas que se esfuerzan salen adelante, sus hijos tenderán a percibir menor meritocracia respecto a esta afirmación, constituyendo evidencia que contradice lo hipotetizado, como también los resultados en la Tabla \@ref(tab:getah). Segundo, se observa que el término de interacción del sentido de justicia directo muestra ser positivo y significativo para quienes declaran recibir notas menores a las que merecen, como también para aquellos que reciben mayores notas de las que merecen. Al respecto, la Figura \@ref(fig:interac2) muestra que para quienes sienten recibir notas menores a las que merecen, la asociación negativa entre percepción de meritocracia de apoderados y estudiantes tiende a moderarse positivamente, tendencia que se mantiene también para quienes declaran obtener notas mayores a las que merecen. En suma, si bien la relación entre percepción de meritocracia de apoderados y estudiantes es negativa, la experiencia de justicia en las notas de estudiantes modera positivamente dicha relación, lo cual se puede observar en la Figura \@ref(fig:interac2) para aquellos estudiantes que manifestaron estar "Strongly Agree" con la afirmación de que en Chile quienes se esfuerzan salen adelante.     


```{r interac2, fig.width=11, fig.height=6,fig.cap="Interaction between parental, student and meritocratic perceptions and justice in grades", echo=FALSE, out.width='100%'}
# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, haven, texreg, sjPlot, lme4, ordinal, ggplot2) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")

# Seleccionar variables
basereg <- ap_est %>% select(perc_trabajo_duro_factor_est,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_est,
                             perc_esfuerzo_est,
                             perc_trabajo_duro_factor_ap,
                             perc_esfuerzo_factor_ap,
                             perc_tduro_bi_est,
                             perc_tduro_bi2_est,
                             perc_tduro_bi3_est,
                             perc_esfuerzo_bi_est,
                             perc_tduro_bi_ap,
                             perc_tduro_bi2_ap,
                             perc_tduro_bi3_ap,
                             perc_esfuerzo_bi_ap,
                             prom_percmer_est,
                             prom_percmer_ap,
                             sj_direct_factor,
                             sj_indirect_noln,
                             sj_indirect_ln,
                             sj_indirect_cat,
                             sj_indirect_qtil,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             recompensa_est,  # recompensa en escuela
                             resp_prof,# justicia trato profesor
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             genero_factor_est,
                             dependencia_factor_ap,
                             # ingresos_esc,
                             # ingresos_pc_esc,
                             # univ_esc,
                             univ,
                             rbd_est,
                             nse_grupo,univ
                             ) %>% na.omit(basereg)

omit_coef="(Intercept)|(libros_hogar_factor_ap)|(pos_pol_factor_ap)|(pos_pol_factor_est)|(genero_factor_est)|(dependencia_factor_ap)"
con <-c(
  "quintiles_ingresos_pc_factor",
  "libros_hogar_factor_ap",
  "educ_factor_ap",
  "pos_pol_factor_ap",
  "pos_pol_factor_est",
  "genero_factor_est",
  "dependencia_factor_ap"
  ) # Omitir coeficientes dela visualización
ref <- "(1|rbd_est)"


# Elaborar modelo de interacción
effort.or7 <- ordinal::clmm(formula(paste("perc_esfuerzo_factor_est~",paste(c("perc_esfuerzo_bi_ap","sj_indirect_ln","sj_direct_factor", con, "perc_esfuerzo_bi_ap*sj_direct_factor",ref),collapse="+"))), basereg)

# Preparar datos para gráfico
basereg$fitted_or7 <- effort.or7$fitted.values
pred_or7<- basereg %>%
  dplyr::mutate(sj_direct_factor=relevel(sj_direct_factor,ref = "Less than I deserve")) %>%
  dplyr::group_by(perc_esfuerzo_factor_est,perc_esfuerzo_bi_ap,sj_direct_factor) %>%
  dplyr::summarise(yhat=mean(fitted_or7))

# Elaborar gráfico interacción
graph_interact <- ggplot2::ggplot(data=pred_or7, aes(x=perc_esfuerzo_bi_ap, y=yhat,
                          group=sj_direct_factor,
                          color=sj_direct_factor,
                         # fill=sj_direct_factor
                         )) +
  geom_point() +
  geom_line()+
  scale_x_discrete(labels = c("Disagree", "Agree")) +   
  facet_grid(~perc_esfuerzo_factor_est) +
  xlab("In Chile, those who make an effort get ahead (parents)") +
  ylab("Probability") +
  scale_color_discrete("Justice in grades - Direct") +
  theme(legend.position="bottom")

graph_interact
```

# Conclusiones

En este artículo aborda la socialización de percepciones meritocráticas. Las hipótesis centrales giraron en torno a dos agentes de socialización: la familia y la escuela. Además, indagamos si la relación entre nivel socioeconómico y percepciones meritocráticas se replicaba en población joven. Primero, propusimos que dado el rol fundamental que tiene la familia en la formación de los jóvenes, las percepciones meritocráticas podrían ser transmitidas de padres a hijos. Según los resultados, sí hay evidencia lo suficientemente robusta para sostener que las percepciones de los padres se transmiten a las de sus hijos. En segundo lugar, que al igual que sucede con las actitudes políticas, las percepciones meritocráticas podrían encontrarse afectadas por la experiencia de justicia distributiva en la escuela. En contraste a la primera hipótesis, no hay suficiente evidencia para sostener esta relación, ya sea con una medición directa del sentido de justicia o con la fórmula propuesta por @jasso_new_1980. En otras palabras, la percepción de meritocracia parece ser indiferente a las experiencias que tengan los estudiantes con respecto a la distribución de notas en la escuela. Tercero, probamos si la relación entre nivel socioeconómico y percepciones meritocráticas se replicaba en jóvenes, hallando evidencia para sostener la hipótesis en el nivel individual, pero no para el nivel escuela. También, propusimos una interacción entre las percepciones meritocráticas de los padres y el sentido de justicia. Los resultados preliminares muestran evidencia del efecto moderador del sentido de justicia en las notas en la transmisión de percepciones de padres a hijos. Finalmente, evaluamos dos hipótesis de mediación de las cuáles no se hallaron resultados significativos.

Los resultados de esta investigación nos invitan a discutir en torno a tres puntos relevantes. El primero se relaciona a la legitimación de las desigualdades. El estudio de las desigualdades desde una perspectiva actitudinal ha mostrado consistentemente cómo las desigualdades pueden ser legitimadas por parte de los individuos [@castillo_legitimacy_2011]. Los individuos que perciben que la sociedad funciona acorde a los criterios meritocráticos tienden a prestar menos apoyo a políticas sociales [@sandel_tirania_2021] y, en última instancia, a preocuparse menos del bien común y la solidaridad. Si se lleva esta problemática al plano de la transmisión intergeneracional, entonces se podría plantear que la legitimación de la desigualdad se comienza a formar tempranamente en la adolescencia: si los jóvenes forman sus percepciones meritocráticas desde la esfera familiar, entonces se puede ver la legitimación de la desigualdad cómo un proceso de reproducción continuo y temprano. Entonces ¿cómo hacemos a nivel de política pública para disminuir los niveles de desigualdad si es que a nivel subjetivo no solo se legitiman, sino que se legitiman intergeneracionalmente? Los resultados dan luces para pensar en esa dirección, ya que la experiencia de justicia en la escuela demuestra un efecto moderador en esta relación, es decir: tiene el potencial de mitigar la formación de percepciones meritocráticas aprendidas en la familia. Poner el foco en cómo los niños experimentan justicia en la escuela podría entonces ayudar a formar ciudadanos más preocupados por el bien común.

El segundo punto de relevancia se relaciona a los aportes que esta investigación hace hacia la agenda de justicia en la escuela. El concepto de sentido de justicia tiene una larga data en el estudio de la justicia distributiva [@jasso_justice_1978], siendo respaldado teórica y empíricamente [@jasso_new_1980] y trabajado en población escolar [@resh_justice_2016]. Lo que llama la atención respecto de los resultados es que los efectos directos del sentido de justicia no han podido confirmarse con las pruebas realizadas, en contraste a los hallazgos de @resh_sense_2014; @resh_sense_2017 que muestran su relevancia cómo predictor para distintos tipos de actitudes y comportamientos políticos. En cambio, sí se ha podido confirmar el efecto moderador del sentido de justicia, pero medido de forma directa y no con la función propuesta por @jasso_new_1980. Este contraste abre una serie de preguntas: ¿las percepciones meritocráticas pertenecen a un conjunto de características muy distintas a las actitudes y comportamientos políticos? ¿la medición directa del sentido de justicia tiene algún beneficio en términos de medición por sobre la medición indirecta? ¿o simplemente la sensación de justicia en las notas no es un predictor tan relevante y es necesario avanzar hacia el estudio de otros recursos distribuidos en la escuela? Estas preguntas sirven de punto de partida para estudios posteriores.

El tercer y último punto a discutir tiene que ver con el tipo de socialización estudiada hasta ahora y los aportes que este artículo hace. Los estudios con perspectiva de socialización generalmente se han centrado en cómo los valores y actitudes son aprendidos en función de los contextos. Lo que hemos denominado cómo socialización de la institucionalidad económica asume que son las características de un país las que influyen en las creencias meritocráticas [@smith_two_2012 ; @orkeny_views_2000]. Asimismo, desde la sociología de Bourdieu se afirma que es el paso por la universidad y la socialización de valores dominantes lo que lleva a respaldar la meritocracia [@baer_education_2008]. También, numerosos estudios empíricos trabajan en torno a la idea de que son determinados períodos los que forman estas creencias [@legarrec_distributive_2015; @ignacz_remains_2018; @vanheuvelen_intercohort_2018]. Si bien todos han sido grandes contribuciones, hasta ahora no se había hecho la pregunta de ¿quiénes son los que contribuyen a formar esas creencias y percepciones? Este estudio ha contribuido con evidencia suficiente para sostener que la familia es un agente socializador de la meritocracia y que la escuela puede contribuir a mitigar esa asociación. De todos modos, aún queda por explorar cuáles son las formas en las que estos agentes contribuyen a transmitir la meritocracia ¿es una socialización de tipo activa cómo plantea @calarco_coached_2014? ¿o se da de forma más automática en discusiones de sobremesa y otras instancias?

Pese a los aportes de esta investigación, es necesario señalar algunas limitaciones relevantes. En primer lugar, se puede apreciar un tema de potencia estadística asociado a la cantidad de casos utilizados, pues si bien la muestra cuenta con aproximadamente 1700 estudiantes, solo cerca de 700 padres respondieron la encuesta, los cuales no siempre respondieron todas las preguntas. Por ello, al dejar una muestra que posee padres y estudiantes pareados, el número con el que se trabaja se reduce drásticamente a `r dim(df_reducida)[1]`. Esto es perjudicial en tanto la relación hipotetizada entre sentido de justicia en las notas y percepciones meritocráticas de los estudiantes solo es significativa con la muestra de solo estudiantes y no con la muestra restringida según los apoderados que respondieron. En segundo lugar, las preguntas presentes en el cuestionario no permiten medir las distintas dimensiones de las creencias meritocráticas, distinguiendo según percepciones, preferencias e ideas meritocráticas y antimeritocraticas. Más bien, debido a las preguntas del cuestionario sólo fue posible incorporar percepciones meritocráticas lo que puede afectar la validez del constructo dependiente al no controlarlo por las otras dimensiones. En último lugar, el que este sea un estudio de corte transversal y no longitudinal imposibilita estudiar la dirección de las relaciones, por ejemplo, este trabajo supone, basados en los estudios de socialización política que las percepciones meritocráticas son traspasadas de padres a hijos, cuando bien podría ser también de manera opuesta.


# Referencias

<div id="refs"></div>

<!-- # (APPENDIX) Apéndice {-} -->


```{r meds, eval=FALSE, include=FALSE}

# Funciones para renderizar tablas tanto en HTML como en pdf
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, haven, texreg, sjPlot, lme4, ordinal, fastDummies) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias
                      cache = FALSE,    # cache de los chunks,usar analisis pesados
                      out.width = '85%',# largo de imagen en %
                      fig.pos= "H",     # posicion figuras H = HERE
                      echo = FALSE      # incluir chunk en output
                      )

table_format = if(is_html_output()) { # Usar en argumento "format=" de kable
  "html"
} else if(is_latex_output()) {
  "latex"
}

# Otras configuraciones
options(scipen=999) # notacion cientifica
options(knitr.kable.NA = '') # NA en kable = ''

# Cargar base de datos procesada
load(file = "input/data/ap_est.RData")


#centrar variables
#ap_est <-  ap_est %>% group_by(rbd_est) %>% mutate(perc_esfuerzo_est_mdg = mean(perc_esfuerzo_est,na.rm =T))
#ap_est <- ap_est %>%  mutate(perc_esfuerzo_est_cmg = perc_esfuerzo_est - mean(perc_esfuerzo_est_mdg,na.rm =T))


#ap_est <-  ap_est %>% group_by(rbd_est) %>% mutate(ingresos_pc_mdg = mean(ingresos_pc,na.rm =T))
#ap_est <- ap_est %>%  mutate(ingresos_pc_cmg = ingresos_pc - mean(ingresos_pc_mdg,na.rm =T))


#ap_est$perc_esfuerzo_ap_mdg %>% head()


ap_est$perc_trabajo_duro_ap_numeric= as.numeric(ap_est$perc_trabajo_duro_factor_ap) #Convertir variable a númerica

# Preparar base
ap_est <-  ap_est %>% dplyr::group_by(rbd_est) %>% dplyr::mutate(perc_trabajo_duro_ap_mdg = mean(perc_trabajo_duro_ap_numeric,na.rm =T))
ap_est <- ap_est %>%  mutate(perc_trabajo_duro_ap_cmg = perc_trabajo_duro_ap_numeric - mean(perc_trabajo_duro_ap_mdg,na.rm =T))
ap_est$perc_trabajo_duro_est_num=as.numeric(ap_est$perc_trabajo_duro_factor_est)

# Seleccionar variables
basereg <- ap_est %>% dplyr::select(perc_trabajo_duro_est_num,
                             perc_esfuerzo_factor_est,
                             perc_trabajo_duro_ap_cmg,
                             perc_esfuerzo_factor_ap,
                             sj_direct_cwc,
                             sj_indirect_ln,
                             quintiles_ingresos_pc_factor,
                             educ_factor_ap,
                             libros_hogar_factor_ap,
                             pos_pol_factor_ap,
                             pos_pol_factor_est,
                             recompensa_factor_est,
                             resp_prof_factor,
                             genero_factor_est,
                             dependencia_factor_ap,
                             ingresos_esc,
                             ingresos_pc_esc,
                             univ_esc,
                             # rbd_est
                             ) %>% na.omit(basereg) %>% dplyr::select(-recompensa_factor_est,-resp_prof_factor)


basereg$perc_trabajo_duro_ap_cmg=as.numeric(basereg$perc_trabajo_duro_ap_cmg) # Pasar a númerico
basereg <- dummy_cols(basereg, select_columns = "quintiles_ingresos_pc_factor") # Dummificar
basereg <- basereg %>% rename(quintil_1= `quintiles_ingresos_pc_factor_Quintil 1`, # Renombrar
                      quintil_2 =`quintiles_ingresos_pc_factor_Quintil 2`,
                      quintil_3=`quintiles_ingresos_pc_factor_Quintil 3`,
                      quintil_4=`quintiles_ingresos_pc_factor_Quintil 4`,
                      quintil_5=`quintiles_ingresos_pc_factor_Quintil 5`,
                      quintil_ns=`quintiles_ingresos_pc_factor_No sabe/No responde`)


# Modelos multinivel
med.fit <- lme4::lmer(perc_trabajo_duro_ap_cmg ~ 1 + quintil_2 + quintil_3 + quintil_4 + quintil_5  + quintil_ns  + sj_direct_cwc + pos_pol_factor_ap +
                      pos_pol_factor_est +
                      genero_factor_est +
                      libros_hogar_factor_ap +
                      dependencia_factor_ap + (1|rbd_est), data = basereg)


out.fit <- lme4::lmer(perc_trabajo_duro_est_num ~ 1 + quintil_2 + quintil_3 + quintil_4 + quintil_5  + quintil_ns  + perc_trabajo_duro_ap_cmg +  sj_direct_cwc  +
                      pos_pol_factor_ap +
                      pos_pol_factor_est +
                      genero_factor_est +
                      libros_hogar_factor_ap +
                      dependencia_factor_ap + (1 + perc_trabajo_duro_ap_cmg |rbd_est), data = basereg)

# Modelos mediación
med.outq2 <- mediation::mediate(med.fit, out.fit, treat = "quintil_2", mediator = "perc_trabajo_duro_ap_cmg",sims = 100)
med.outq3 <- mediation::mediate(med.fit, out.fit, treat = "quintil_3", mediator = "perc_trabajo_duro_ap_cmg",sims = 100)
med.outq4 <- mediation::mediate(med.fit, out.fit, treat = "quintil_4", mediator = "perc_trabajo_duro_ap_cmg",sims = 100)
med.outq5 <- mediation::mediate(med.fit, out.fit, treat = "quintil_5", mediator = "perc_trabajo_duro_ap_cmg",sims = 100)
med.outqns <- mediation::mediate(med.fit, out.fit, treat = "quintil_ns", mediator = "perc_trabajo_duro_ap_cmg",sims = 100)

# Summarys modelos mediación
med.outq2su<-summary(med.outq2)
med.outq3su=summary(med.outq3)
med.outq4su=summary(med.outq4)
med.outq5su=summary(med.outq5)
med.outqnssu=summary(med.outqns)


omit_coef="(Intercept)|(sj_direct_cwc)|(libros_hogar_factor_ap)|(pos_pol_factor_ap)|(pos_pol_factor_est)|(genero_factor_est)|(dependencia_factor_ap)" # Omitir coeficientes de la visualización




# texreg::knitreg(list(med.fit,out.fit),caption = "Mediación percepción padres", custom.model.names = c("PM Apoderado","PM Estudiante"),
#         omit.coef = omit_coef,
#         caption.above = T,
#         #star.symbol = "\\*",
#         center = T,
#         custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Controles aplicados en todos los modelos")





# Modelos multinivel
med.fitn <- lmer(sj_direct_cwc ~ 1 + quintil_2 + quintil_3 + quintil_4 + quintil_5  + quintil_ns + perc_trabajo_duro_ap_cmg+
                      pos_pol_factor_ap +
                      pos_pol_factor_est +
                      genero_factor_est +
                      libros_hogar_factor_ap +
                      dependencia_factor_ap + (1|rbd_est), data = basereg)


out.fitn <- lmer(perc_trabajo_duro_est_num ~ 1 + quintil_2 + quintil_3 + quintil_4 + quintil_5  + quintil_ns + sj_direct_cwc + perc_trabajo_duro_ap_cmg +   pos_pol_factor_ap +
                      pos_pol_factor_est +
                      genero_factor_est +
                      libros_hogar_factor_ap +
                      dependencia_factor_ap +(1|rbd_est), data = basereg)


# Modelos mediación
med.outq2sj <- mediation::mediate(med.fit, out.fit, treat = "quintil_2", mediator = "sj_direct_cwc",sims = 100)
med.outq3sj <- mediation::mediate(med.fit, out.fit, treat = "quintil_3", mediator = "sj_direct_cwc",sims = 100)
med.outq4sj <- mediation::mediate(med.fit, out.fit, treat = "quintil_4", mediator = "sj_direct_cwc",sims = 100)
med.outq5sj <- mediation::mediate(med.fit, out.fit, treat = "quintil_5", mediator = "sj_direct_cwc",sims = 100)
med.outqnssj <- mediation::mediate(med.fit, out.fit, treat = "quintil_ns", mediator = "sj_direct_cwc",sims = 100)

# Summary modelos mediación
med.outq2susj<-summary(med.outq2sj)
med.outq3susj=summary(med.outq3sj)
med.outq4susj=summary(med.outq4sj)
med.outq5susj=summary(med.outq5sj)
med.outqnssusj=summary(med.outqnssj)


omit_coef="(Intercept)|(perc_trabajo_duro_ap_cmg)|(libros_hogar_factor_ap)|(pos_pol_factor_ap)|(pos_pol_factor_est)|(genero_factor_est)|(dependencia_factor_ap)" # Omitir coeficientes en la visualización


# texreg::knitreg(list(med.fitn,out.fitn),caption = "Mediación Sensación de Justicia ", custom.model.names = c("SJ Notas","PM Estudiante"),
#         omit.coef = omit_coef,
#         caption.above = T,
#         #star.symbol = "\\*",
#         center = T,
#         custom.note = "$***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br> Controles aplicados en todos los modelos")
#summary(med.outn)


# Preparar tabla resumen
collapse_rows_dt <- data.frame( Independiente = c(rep("Percepción Meritocratica Padres",5),rep("Sensación Justicia Notas",5)), Mediador = c("Quintil 2","Quintil 3","Quintil 4","Quintil 5","Quintil Ns/Nr"),

                     'Efectos Directos' = c(paste0(round(c(med.outq2su$z0,med.outq3su$z0,med.outq4su$z0,med.outq5su$z0,med.outqnssu$z0),4),gtools::stars.pval(c(med.outq2su$z0.p,med.outq3su$z0.p,med.outq4su$z0.p,med.outq5su$z0.p,med.outqnssu$z0.p))),paste0(round(out.fitn@beta[2:6],4),gtools::stars.pval(c(med.outq2susj$z0.p,med.outq3susj$z0.p,med.outq4susj$z0.p,med.outq5susj$z0.p,med.outqnssusj$z0.p)))),

                'Efectos Indirectos' = c(paste0(round(c(med.outq2su$d0,med.outq3su$d0,med.outq4su$d0,med.outq5su$d0,med.outqnssu$d0),4),gtools::stars.pval(c(med.outq2su$d0.p,med.outq3su$d0.p,med.outq4su$d0.p,med.outq5su$d0.p,med.outqnssu$d0.p))),paste0(round(out.fitn@beta[18:22],4),gtools::stars.pval(c(med.outq2susj$d0.p,med.outq3susj$d0.p,med.outq4susj$d0.p,med.outq5susj$d0.p,med.outqnssusj$d0.p)))),



                 'Efectos Totales' =  c(
                   paste0(round(c(med.outq2su$tau.coef,med.outq3su$tau.coef,med.outq4su$tau.coef,med.outq5su$tau.coef,med.outqnssu$tau.coef),4),gtools::stars.pval(c(med.outq2su$tau.p,med.outq3su$tau.p,med.outq4su$tau.p,med.outq5su$tau.p,med.outqnssu$tau.p))),
paste0(round(c(med.outq2susj$tau.coef,med.outq3susj$tau.coef,med.outq4susj$tau.coef,med.outq5susj$tau.coef,med.outqnssusj$tau.coef),4),gtools::stars.pval(c(med.outq2susj$tau.p,med.outq3susj$tau.p,med.outq4susj$tau.p,med.outq5susj$tau.p,med.outqnssusj$tau.p)))),


                 'Porcentaje Indirecto' = c(paste0(round(c(med.outq2su$n1*100,med.outq3su$n1*100,med.outq4su$n1*100,med.outq5su$n1*100,med.outqnssu$n1*100),1),"%"),paste0(round(c(med.outq2susj$n1*100,med.outq3susj$n1*100,med.outq4susj$n1*100,med.outq5susj$n1*100,med.outqnssusj$n1*100),1), '%' )))



# Renderizar tabla
kable(collapse_rows_dt, format =table_format, booktabs = T, caption = "Resumen Modelos de Mediación Percepciones Meritocráticas Estudiantes", align = "c",col.names = c("Mediador (Centrada)","Independiente", "Efectos Directos", "Efectos Indirectos", "Efectos Totales", "% de Efectos Indirectos")) %>%
   kable_styling(full_width = F,latex_options = c("scale_down","HOLD_position")) %>%
     column_spec(1, bold = T) %>% collapse_rows(columns = 1:3, valign = "top") %>%  add_header_above(c(" " = 2, "Efectos sobre Percepcion Meritocratica Estudiantes" = 4), bold = T) %>%
  footnote(paste0("N= ",dim(basereg)[1],", ","*** p< 0.001; ** p< 0.01; * p< 0.05"),
           footnote_as_chunk = T,
           general_title = "Nota: " )




```
