corrplot(
cormat,
method = "color",
type = "upper",
tl.col = "black",
addCoef.col = "black",
diag = TRUE,
family = "A",
number.font = 6,
tl.cex =0.75,
number.cex = 1)
# Matriz de correlación entre ingresos + variables control
basecor<- ap_est %>% select(ingresos_tramos, ingresos, ingresos_pc, ingresos_esc, ingresos_pc_esc, heterogen_esc, educ_madre, educ_padre, educ, univ, univ_esc, libros_hogar_est, libros_hogar_ap, genero_est, genero_ap, pos_pol_est, pos_pol_ap, edad )
cormat=cor(basecor, use = "complete.obs")
#save
#png("../output/images/correlacionl2.png",width=600,height=600)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
"A. Ingresos del hogar en tramos",
"B. Ingresos del hogar",
"C. Ingresos per capita",
"D. Ingresos del hogar por escuela",
"E. Ingresos per capita por escuela",
"F. Heterogeneidad por escuela",
"G. Educación de la madre",
"H. Educación del padre",
"I. Educación del apoderado",
"J. Dummy universitaria apoderado",
"K. Universitaria por escuela",
"L. Libros en el hogar estudiante",
"M. Libros en el hogar apoderado",
"N. Genero estudiante",
"O. Genero apoderado",
"P. Posición política estudiante",
"Q. Posición política apoderado",
"R. Edad apoderado")
colnames(cormat) <-c("(A)","(B)","(C)","(D)", "(E)", "(F)",  "(G)",  "(H)",  "(I)",  "(J)",  "(K)",  "(L)",  "(M)",  "(N)",  "(O)",  "(P)",  "(Q)",  "(R)")
corrplot(
cormat,
method = "color",
type = "upper",
tl.col = "black",
addCoef.col = "black",
diag = TRUE,
family = "A",
number.font = 6,
tl.cex =0.75,
number.cex = 0.5)
# Matriz de correlación con otras variables de interés
basecor<- ap_est %>% select(perc_trabajo_duro_est,perc_trabajo_duro_ap,perc_esfuerzo_est,perc_esfuerzo_ap,sj_indirect_ln,sj_direct,ingresos_pc_esc, perc_falta_talento_ap, perc_falta_talento_est, perc_falta_esfuerzo_est, perc_falta_esfuerzo_ap, perc_familia_rica_est, perc_familia_rica_ap)
cormat=cor(basecor, use = "complete.obs")
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
"A. Trabajo Duro Estudiantes",
"B. Trabajo Duro Apoderados",
"C. Esfuerzo Estudiantes",
"D. Esfuerzo Apoderados",
"E. Sentido justicia in",
"F. Sentido justicia dir",
"G. Ingresos",
"H. ap Ftalento",
"I. est Ftalento",
"J. est Fesf",
"K. ap Fest",
"M. est famrich",
"N. ap famrich")
colnames(cormat) <-c("(A)", "(B)","(C)","(D)","(E)","(F)", "(G)", "(H)","(I)", "(J)","(K)","(M)","(N)")
corrplot(
cormat,
method = "color",
type = "upper",
tl.col = "black",
addCoef.col = "black",
diag = TRUE,
family = "A",
number.font = 6,
tl.cex =0.75,
number.cex = 1)
table(basecor$perc_trabajo_duro_est==basecor$perc_trabajo_duro_ap)
table(ap_est$rbd_est)
base218<- ap_est %>% filter(rbd_est==218)
table(is.na(base218$ingresos_esc))
table(base218$ingresos_esc)
table(base218$ingresos)
# Modelos 0: nulos con indicadores separados
mmn_1 <- clmm(factor(perc_esfuerzo_est) ~ 1 + (1|rbd_est), data = ap_est)
mmn_2 <- clmm(factor(perc_trabajo_duro_est) ~ 1 + (1|rbd_est), data = ap_est)
# Modelos 0: nulos con promedio indicadores
mmnp <- lmer(prom_percmer_est ~ 1 + (1|rbd_est), data = ap_est)
# Modelos 0: nulos factores
# Tabla
#stargazer(mmni_1, type = "html",
#          style = "apsr",
#         title = "Modelos Nulos",
#        header = FALSE,
#       single.row = TRUE)
summary(mmn_1)
summary(mmn_2)
summary(mmnp)
# Modelos 1: L1 con indicadores separados
mml1_1 <- clmm(factor(perc_esfuerzo_est) ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
(1|rbd_est), data = ap_est)
mml1_2 <- clmm(factor(perc_trabajo_duro_est) ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
(1|rbd_est), data = ap_est)
# Modelos 1: L1 con promedio indicadores
mml1p <- lmer(prom_percmer_est ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
(1|rbd_est), data = ap_est)
# Modelos 1: L1 factores
# Tabla
#stargazer(mml1_1, mml1_2, type = "html",
#          style = "apsr",
#         title = "Modelos L1",
#        header = FALSE,
#       single.row = TRUE)
summary(mml1_1)
summary(mml1_2)
summary(mml1p)
# Modelos 2: L2 con indicadores separados
mml2_1 <- clmm(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc + (1|rbd_est), data = ap_est)
mml2_2 <- clmm(factor(perc_trabajo_duro_est) ~ ingresos_esc +
univ_esc +
heterogen_esc + (1|rbd_est), data = ap_est)
# Modelos 2: L2 con promedio indicadores
mml2p <- lmer(prom_percmer_est ~ ingresos_esc +
univ_esc +
heterogen_esc + (1|rbd_est), data = ap_est)
# Modelos 2: L2 factores
# Tabla
#stargazer(mml2_1, mml1_2, type = "html",
#         style = "apsr",
#        title = "Modelos L2",
#       header = FALSE,
#      single.row = TRUE)
summary(mml2_1)
summary(mml2_2)
summary(mml2p)
# Modelos 3: L1+L2 con indicadores separados
mml1l2_1 <- clmm(factor(perc_esfuerzo_est) ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc + (1|rbd_est), data = ap_est)
mml1l2_2 <- clmm(factor(perc_trabajo_duro_est) ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc + (1|rbd_est), data = ap_est)
# Modelos 3: L1+L2 con promedio indicadores
mml1l2p <- lmer(prom_percmer_est ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc + (1|rbd_est), data = ap_est)
# Modelos 3: L1+L2 factores
# Tabla
#stargazer(mml1l2_1, mml1l2_2, type = "html",
#         style = "apsr",
#        title = "Modelos L1+L2",
#       header = FALSE,
#      single.row = TRUE)
summary(mml1l2_1)
summary(mml1l2_2)
summary(mml1l2p)
# Modelos 4: interacción y controles con indicadores separados
mmin_1 <- clmm(factor(perc_esfuerzo_est) ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc +
perc_esfuerzo_ap*sj_indirect_ln +
perc_trabajo_duro_ap*sj_indirect_ln +
perc_esfuerzo_ap*sj_direct +
perc_trabajo_duro_ap*sj_direct +
region_est +
dependencia_est +
pos_pol_est +
genero_est +
educ_padre +
educ_madre +
libros_hogar_est +
recompensa +
pos_pol_ap +
genero_ap +
educ +
libros_hogar_ap +
recompensa_hijos +
edad +
(1|rbd_est), data = ap_est)
mmin_2 <- clmm(factor(perc_trabajo_duro_est) ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc +
perc_esfuerzo_ap*sj_indirect_ln +
perc_trabajo_duro_ap*sj_indirect_ln +
perc_esfuerzo_ap*sj_direct +
perc_trabajo_duro_ap*sj_direct +
region_est +
dependencia_est +
pos_pol_est +
genero_est +
educ_padre +
educ_madre +
libros_hogar_est +
recompensa +
pos_pol_ap +
genero_ap +
educ +
libros_hogar_ap +
recompensa_hijos +
edad +
(1|rbd_est), data = ap_est)
# Modelos 4: interacción y controles con promedio indicadores
mminp <- lmer(prom_percmer_est ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc +
perc_esfuerzo_ap*sj_indirect_ln +
perc_trabajo_duro_ap*sj_indirect_ln +
perc_esfuerzo_ap*sj_direct +
perc_trabajo_duro_ap*sj_direct +
region_est +
dependencia_est +
pos_pol_est +
genero_est +
educ_padre +
educ_madre +
libros_hogar_est +
recompensa +
pos_pol_ap +
genero_ap +
educ +
libros_hogar_ap +
recompensa_hijos +
edad +
(1|rbd_est), data = ap_est)
# Modelos 4: interacción y controles factores
# Tabla
#stargazer(mmin_1, mmin_2, type = "html",
#         style = "apsr",
#        title = "Modelos + Interaccion",
#       header = FALSE,
#      single.row = TRUE)
summary(mmin_1)
summary(mmin_2)
summary(mminp)
baseafc<- ap_est %>% select(perc_trabajo_duro_est,perc_trabajo_duro_ap,perc_esfuerzo_est,perc_esfuerzo_ap, perc_falta_talento_ap, perc_falta_talento_est, perc_falta_esfuerzo_est, perc_falta_esfuerzo_ap,sj_indirect_noln, ingresos_pc, rbd_est)
baseafc <- set_na(baseafc, na = c(5,9), drop.levels = TRUE, as.tag = FALSE)
baseafc=na.omit(baseafc)
model01 <- 'perc_merit_est=~perc_trabajo_duro_est + perc_esfuerzo_est
atri_merit_est=~perc_falta_talento_est+perc_falta_esfuerzo_est
perc_merit_ap=~perc_trabajo_duro_ap + perc_esfuerzo_ap
atri_merit_ap=~perc_falta_talento_ap+perc_falta_esfuerzo_ap
'
fit1_o <- cfa(model = model01,data = baseafc,
ordered = c("perc_trabajo_duro_est","perc_esfuerzo_est","perc_falta_talento_est", "perc_falta_esfuerzo_est","perc_trabajo_duro_ap","perc_esfuerzo_ap","perc_falta_talento_ap","perc_falta_esfuerzo_ap"))
#---------------------------------------------------#
fitMeasures(fit1_o, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea"))
summary(fit1_o, fit.measures=T, standardized=T)
p1a <- predict(fit1_o)
scores_apod = as.data.frame(p1a)
# Merge with factor scores
apod_cfa2_sco = cbind(baseafc, scores_apod)
# Check
stargazer(apod_cfa2_sco, type = "text")
# Save  factor scores
basecor<- apod_cfa2_sco[,9:15]
basecor<- basecor[-c(3)]
#basecor=na.omit(basecor)
cormat=cor(basecor, use = "na.or.complete")
#save
#png("output/results/corplot_totscores.png",width=600,height=600)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
"A. Sentido de justicia notas",
"B. Ingreso familiar",
"C. Percepción meritocratica Estudiante",
"D. Atribución de pobreza meritocratica Estudiante",
"E. Percepción meritocratica Apoderado",
"F. Atribución de pobreza meritocratica Apoderado")
colnames(cormat) <-c("(A)", "(B)","(C)","(D)","(E)","(F)")
corrplot(
cormat,
method = "color",
type = "upper",
tl.col = "black",
addCoef.col = "black",
diag = TRUE,
family = "A",
number.font = 6,
tl.cex =0.75,
number.cex = 1)
results_0_accum  = lmer(perc_merit_est ~ 1 + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_1_accum  = lmer(perc_merit_est ~ 1 + ingresos_pc + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_2_accum  = lmer(perc_merit_est ~ 1 + sj_indirect_noln + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_3_accum  = lmer(perc_merit_est ~ 1 +  perc_merit_ap + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_4_accum  = lmer(perc_merit_est ~ 1 + atri_merit_ap + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_5_accum  = lmer(perc_merit_est ~ 1 + perc_merit_ap + atri_merit_ap +  sj_indirect_noln + ingresos_pc + (1| rbd_est), data = apod_cfa2_sco, REML=F)
htmlreg(list(results_0_accum, results_1_accum,results_2_accum, results_3_accum,results_4_accum,results_5_accum), custom.coef.names = c("Intercepto", "Ingresos Percapita", "Sentido de justicia", "Percepción Meritocratica Apoderados", "Atribución Meritocratica Apoderados"), star.symbol = "\\*", center = T, custom.note = " <div style='text-align: justify'> $***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br>" , caption.above = T, caption = "Socialización de la percepción meritocratica")
frq(ap_est$heterogen_esc)
frq(ap_est$ingresos_esc)
mml2_2 <- clmm(factor(perc_trabajo_duro_est) ~ ingresos_esc +
univ_esc +
#heterogen_esc
+ (1|rbd_est), data = ap_est, na.action)
mml2_2 <- clmm(factor(perc_trabajo_duro_est) ~ ingresos_esc +
univ_esc +
#heterogen_esc
+ (1|rbd_est), data = ap_est, na.action = T)
mml2_2 <- clmm(factor(perc_trabajo_duro_est) ~ ingresos_esc +
univ_esc +
#heterogen_esc
+ (1|rbd_est), data = ap_est)
# Cargar librerías
pacman::p_load(dplyr, #Manipulacion de datos
stargazer, #Tablas
sjmisc, # Tablas
summarytools, # Tablas
kableExtra, #Tablas
sjPlot, #Tablas y gráficos
corrplot, # Correlaciones
sessioninfo, #  Información de la sesión de trabajo
ggplot2, # Graficos
sjlabelled, # Etiquetas
ordinal, # Modelos ordinales,
mixor, # Modelos ordinales
lme4, # Modelos mixtos,
lavaan, # CFA
texreg # Tablas modelos
)
# Cargar datos
load(file = "../input/data/ap_est.RData") # Base conjunta
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc
+ (1|rbd_est), data = ap_est)
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc
), data = ap_est)
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc
, data = ap_est)
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc, data = ap_est, id = rbd_est, link = "logit")
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc, data = ap_est, id=rbd_est, link="logit")
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc, data = ap_est, id="rbd_est", link="logit")
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc +
univ_esc +
heterogen_esc, data = ap_est, id=rbd_est, link="logit")
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc + univ_esc + heterogen_esc, data = ap_est, id = rbd_est, link="logit")
mml2_1 <- mixor(perc_esfuerzo_est ~ ingresos_esc + univ_esc + heterogen_esc, data = ap_est, id = rbd_est, link="logit")
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc + univ_esc + heterogen_esc, data = ap_est, id = dependencia_est, link="logit")
mmn_1 <- mixor(factor(perc_esfuerzo_est) ~ 1, data = ap_est, id = dependencia_est, link= "logit")
mmn_1 <- mixor(factor(perc_esfuerzo_est) ~ 1, data = ap_est, id = rbd_est, link= "logit")
ap_est_id <- ap_est %>% group_by(rbd_est)
View(ap_est_id)
View(ap_est_id)
ap_est_rbd<-ap_est[order(ap_est$rbd_est),]
mml2_1 <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc + univ_esc + heterogen_esc, data = ap_est_rbd, id = rbd_est, link="logit")
# Tabla
#stargazer(mml2_1, mml1_2, type = "html",
#         style = "apsr",
#        title = "Modelos L2",
#       header = FALSE,
#      single.row = TRUE)
summary(mml2_1)
knitr::opts_chunk$set(
echo = TRUE,
message = FALSE,
warning = FALSE
)
mmin_2 <- mixor(perc_trabajo_duro_est ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc +
perc_esfuerzo_ap*sj_indirect_ln +
perc_trabajo_duro_ap*sj_indirect_ln +
perc_esfuerzo_ap*sj_direct +
perc_trabajo_duro_ap*sj_direct +
region_est +
dependencia_est +
pos_pol_est +
genero_est +
educ_padre +
educ_madre +
libros_hogar_est +
recompensa +
pos_pol_ap +
genero_ap +
educ +
libros_hogar_ap +
recompensa_hijos +
edad, data = ap_est_rbd, id = rbd_est, link="logit")
# Cargar librerías
pacman::p_load(dplyr, #Manipulacion de datos
stargazer, #Tablas
sjmisc, # Tablas
summarytools, # Tablas
kableExtra, #Tablas
sjPlot, #Tablas y gráficos
corrplot, # Correlaciones
sessioninfo, #  Información de la sesión de trabajo
ggplot2, # Graficos
sjlabelled, # Etiquetas
ordinal, # Modelos ordinales,
mixor, # Modelos ordinales
lme4, # Modelos mixtos,
lavaan, # CFA
texreg # Tablas modelos
)
# Cargar datos
load(file = "../input/data/ap_est.RData") # Base conjunta
# Orden para modelos ordinales (mixor package)
ap_est_rbd<-ap_est[order(ap_est$rbd_est),]
mmin_2 <- mixor(perc_trabajo_duro_est ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc +
perc_esfuerzo_ap*sj_indirect_ln +
perc_trabajo_duro_ap*sj_indirect_ln +
perc_esfuerzo_ap*sj_direct +
perc_trabajo_duro_ap*sj_direct +
region_est +
dependencia_est +
pos_pol_est +
genero_est +
educ_padre +
educ_madre +
libros_hogar_est +
recompensa +
pos_pol_ap +
genero_ap +
educ +
libros_hogar_ap +
recompensa_hijos +
edad, data = ap_est_rbd, id = rbd_est, link="logit")
summary(mmin_2)
mmin_2 <- mixor(factor(perc_trabajo_duro_est) ~ perc_esfuerzo_ap +
perc_trabajo_duro_ap +
sj_indirect_ln +
sj_direct +
ingresos_tramos +
ingresos_esc +
univ_esc +
heterogen_esc +
perc_esfuerzo_ap*sj_indirect_ln +
perc_trabajo_duro_ap*sj_indirect_ln +
perc_esfuerzo_ap*sj_direct +
perc_trabajo_duro_ap*sj_direct +
region_est +
dependencia_est +
pos_pol_est +
genero_est +
educ_padre +
educ_madre +
libros_hogar_est +
recompensa +
pos_pol_ap +
genero_ap +
educ +
libros_hogar_ap +
recompensa_hijos +
edad, data = ap_est_rbd, id = rbd_est, link="logit")
summary(mmin_2)
