---
title: "Análisis descriptivo de datos - Socialización de la meritocracia"
author: "Castillo, J.C., Iturra, J., Meneses, F. & Venegas, M."
date: '`r Sys.Date()`'
output:
  html_document:
    df_print: paged
    theme: readable
    toc: yes
    toc_float: yes
    numbersections: true
editor_options:
  chunk_output_type: inline
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

# Introducción

El presente documento tiene por finalidad el análisis incial de datos para el artículo "La socialización de la meritocracia: el rol de la familia y la escuela" a cargo de Juan Carlos Castillo. El artículo se desarrolla en el marco del proyecto FONDECYT Regular N°1181239: "Socialización política y educación para la ciudadanía: el rol de la familia y de la escuela".

El documento se estructurará en cuatro apartados. El primero corresponde a la carga de datos y las librerías. El segundo a los análisis descriptivos univariados. El tercero a la sección de análisis descriptivos bivariados. Por último, la cuarta sección estará dedicada al análisis multivariado.

# Resumen ejecutivo:

## Sobre el analisis:
- Las variables de percepción concentran más del 80% en las dos categorías más altas.
- En general, las correlaciones de las variables de interés al nivel 1 son bajas.
- Las correlaciones entre porcentaje ed. univ. escuela e ingresos del hogar son de 0.4.

## Registro de cambios desde reunión 21-1-21
- Uso de nueva base a partir de cambios en el procesamiento.
- Cambio en el nombre de variable *get ahead* por *esfuerzo*
- na.omit eliminado en gráficos Likert
- na.omit sustituido por listwise deletion en correlaciones. NOTA: Se agrega el argumento *complete.obs*
- Incorporación propuesta Francisco
- Agrega variables promedio de percepción de meritocracia (en estudiantes y apoderados) a la matriz de correlaciones principales.
- Agrega matriz de correlaciones sobre variables de ingresos y controles
- Agrega sección de análisis mulivariado

## Parte 1: Cargar librerías y datos

```{r}
# Cargar librerías
pacman::p_load(dplyr, #Manipulacion de datos
              stargazer, #Tablas
              sjmisc, # Tablas
              summarytools, # Tablas
              kableExtra, #Tablas
              sjPlot, #Tablas y gráficos
              corrplot, # Correlaciones
              sessioninfo, #  Información de la sesión de trabajo
              ggplot2, # Graficos
              sjlabelled, # Etiquetas
              ordinal, # Modelos ordinales,
              mixor, # Modelos ordinales
              lme4, # Modelos mixtos,
              lavaan, # CFA
              texreg # Tablas modelos
)
# Cargar datos
load(file = "../input/data/ap_est.RData") # Base conjunta

# Orden para modelos ordinales (mixor package)

ap_est_rbd<-ap_est[order(ap_est$rbd_est),]

# Remover etiquetas para rende
ap_est <- sjlabelled::remove_all_labels(ap_est)
```


## Parte 2: Análisis descriptivos univariados
### Descriptivos univariados generales

A continuación se presentan los descriptivos de la base de datos completa:

```{r}
sjPlot::view_df(ap_est, show.type = T, show.prc = T, show.na = T)
```

### Descriptivos univariados variables de hipotesis

Se realizan dos gráficos para variables likert. El primero corresponde a la comparación de percepción del trabajo duro en estudiates y apoderados. El segundo es la misma comparación pero para la percepción de esfuerzo.

```{r fig.width= 10}
# Plot Likert: perc. trabajo duro apoderados y estudiantes

baselik<- ap_est %>% select(perc_trabajo_duro_est,perc_trabajo_duro_ap)

# short var labels
items <- c("Percepcion trabajo duro estudiantes", "Percepcion trabajo duro apoderados")

# cambiar orden para la leyenda
labels= c("Nada Importante", "Poco Importante", "Importante", "Muy Importante")  ### E

#save
#png("../output/images/Plot-lik-trabajoduro.png", width = 750, height = 300)
sjPlot::plot_likert(baselik,
                         axis.labels   = items,
                         legend.labels = labels,
                         legend.pos = "bottom",
                         #cat.neutral   = , # identifica a indiferentes
                         geom.colors   = c("#9ECAE1", "#6BAED6", "#4292C6",
                                           "#2171B5"), # colorbrewer2.org
                         sort.frq      = "neg.asc", # sort descending)
                         title         = "Percepción de meritocracia Apoderados e hijos",
                         intercept.line.color = "white", # vertical middle
                         expand.grid   = F, # no inner margins in plot
                         show.n        = FALSE, # hide N's in axis labels
                         grid.range    = 1.8,
                         geom.size = 0.6, values = "sum.outside")
#dev.off()

```

```{r fig.width= 10}
# Plot Likert: perc. esfuerzo apoderados y estudiantes

baselik<- ap_est %>% select(perc_esfuerzo_est,perc_esfuerzo_ap)

# short var labels
items <- c("Percepcion esfuerzo estudiantes", "Percepcion esfuerzo apoderados")

# cambiar orden para la leyenda
labels= c("Muy en desacuerdo", "En desacuerdo", "De acuerdo", "Muy de acuerdo")  ### E

# save
#png("../output/images/Plot-lik-esfuerzo.png", width = 750, height = 300)
sjPlot::plot_likert(baselik,
                         axis.labels   = items,
                         legend.labels = labels,
                         legend.pos = "bottom",
                         #cat.neutral   = , # identifica a indiferentes
                         geom.colors   = c("#9ECAE1", "#6BAED6", "#4292C6",
                                           "#2171B5"), # colorbrewer2.org
                         sort.frq      = "neg.asc", # sort descending)
                         title         = "Percepción de meritocracia Apoderados e hijos",
                         intercept.line.color = "white", # vertical middle
                         expand.grid   = F, # no inner margins in plot
                         show.n        = FALSE, # hide N's in axis labels
                         grid.range    = 1.8,
                         geom.size = 0.6, values = "sum.outside")
#dev.off()

```

### Descriptivos sentidos de justicia

```{r eval=FALSE, include=FALSE, results='asis'}
select(ap_est, sj_indirect_ln, sj_indirect_noln) %>% summarytools::descr()
```

## Parte 3: Análisis descriptivo bivariado
### Matriz de correlación entre variales principales

```{r}
# Matriz de correlación entre variales principales

basecor<- ap_est %>% select(perc_trabajo_duro_est,perc_trabajo_duro_ap,perc_esfuerzo_est,perc_esfuerzo_ap,prom_percmer_est,prom_percmer_ap,sj_indirect_ln,sj_direct,ingresos_pc_esc)
cormat=cor(basecor, use = "complete.obs")
#save
#png("../output/images/correlacionl1.png",width=600,height=600)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
    "A. Trabajo Duro Estudiantes",
    "B. Trabajo Duro Apoderados",
    "C. Esfuerzo Estudiantes",
    "D. Esfuerzo Apoderados",
    "E. Prom. Perc. Mer. Estudiantes",
    "F. Prom. Perc. Mer. Apoderados",
    "G. Sentido justicia in",
    "H. Sentido justicia dir",
    "I. Ingresos")
colnames(cormat) <-c("(A)", "(B)","(C)","(D)","(E)","(F)", "(G)", "(H)", "(I)")
corrplot(
cormat,
  method = "color",
  type = "upper",
  tl.col = "black",
  addCoef.col = "black",
  diag = TRUE,
  family = "A",
  number.font = 6,
  tl.cex =0.75,
  number.cex = 1)
```

### Matriz de correlación entre variables nivel 2
```{r}
# Matriz de correlación entre variables nivel 2

basecor<- ap_est %>% select(ingresos_esc, ingresos_pc_esc, heterogen_esc, univ_esc)
cormat=cor(basecor, use = "complete.obs")
#save
#png("../output/images/correlacionl2.png",width=600,height=600)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
    "A. Ingresos del hogar por escuela",
    "B. Ingresos per capita por escuela",
    "C. Heterogeneidad socioeconomica escuela",
    "D. Porcentaje ed. tericiaria por escuela")
colnames(cormat) <-c("(A)", "(B)","(C)","(D)")
corrplot(
cormat,
  method = "color",
  type = "upper",
  tl.col = "black",
  addCoef.col = "black",
  diag = TRUE,
  family = "A",
  number.font = 6,
  tl.cex =0.75,
  number.cex = 1)
```


### Matriz de correlación entre ingresos + variables control
```{r}
# Matriz de correlación entre ingresos + variables control
basecor<- ap_est %>% select(ingresos_tramos, ingresos, ingresos_pc, ingresos_esc, ingresos_pc_esc, heterogen_esc, educ_madre, educ_padre, educ_ap, univ, univ_esc, libros_hogar_est, libros_hogar_ap, genero_est, genero_ap, pos_pol_est, pos_pol_ap, edad )
cormat=cor(basecor, use = "complete.obs")
#save
#png("../output/images/correlacionl2.png",width=600,height=600)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
    "A. Ingresos del hogar en tramos",
    "B. Ingresos del hogar",
    "C. Ingresos per capita",
    "D. Ingresos del hogar por escuela",
    "E. Ingresos per capita por escuela",
    "F. Heterogeneidad por escuela",
    "G. Educación de la madre",
    "H. Educación del padre",
    "I. Educación del apoderado",
    "J. Dummy universitaria apoderado",
    "K. Universitaria por escuela",
    "L. Libros en el hogar estudiante",
    "M. Libros en el hogar apoderado",
    "N. Genero estudiante",
    "O. Genero apoderado",
    "P. Posición política estudiante",
    "Q. Posición política apoderado",
    "R. Edad apoderado")
colnames(cormat) <-c("(A)","(B)","(C)","(D)", "(E)", "(F)",  "(G)",  "(H)",  "(I)",  "(J)",  "(K)",  "(L)",  "(M)",  "(N)",  "(O)",  "(P)",  "(Q)",  "(R)")
corrplot(
cormat,
  method = "color",
  type = "upper",
  tl.col = "black",
  addCoef.col = "black",
  diag = TRUE,
  family = "A",
  number.font = 6,
  tl.cex =0.75,
  number.cex = 0.5)
```

```{r eval=FALSE, include=FALSE}
# Matriz de correlación con otras variables de interés

basecor<- ap_est %>% select(perc_trabajo_duro_est,perc_trabajo_duro_ap,perc_esfuerzo_est,perc_esfuerzo_ap,sj_indirect_ln,sj_direct,ingresos_pc_esc, perc_falta_talento_ap, perc_falta_talento_est, perc_falta_esfuerzo_est, perc_falta_esfuerzo_ap, perc_familia_rica_est, perc_familia_rica_ap)

cormat=cor(basecor, use = "complete.obs")
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
    "A. Trabajo Duro Estudiantes",
    "B. Trabajo Duro Apoderados",
    "C. Esfuerzo Estudiantes",
    "D. Esfuerzo Apoderados",
    "E. Sentido justicia in",
    "F. Sentido justicia dir",
    "G. Ingresos",
    "H. ap Ftalento",
    "I. est Ftalento",
    "J. est Fesf",
    "K. ap Fest",
    "M. est famrich",
    "N. ap famrich")
colnames(cormat) <-c("(A)", "(B)","(C)","(D)","(E)","(F)", "(G)", "(H)","(I)", "(J)","(K)","(M)","(N)")
corrplot(
cormat,
  method = "color",
  type = "upper",
  tl.col = "black",
  addCoef.col = "black",
  diag = TRUE,
  family = "A",
  number.font = 6,
  tl.cex =0.75,
  number.cex = 1)

table(basecor$perc_trabajo_duro_est==basecor$perc_trabajo_duro_ap)
```

```{r eval=FALSE, include=FALSE}
table(ap_est$rbd_est)
```

```{r eval=FALSE, include=FALSE}
base218<- ap_est %>% filter(rbd_est==218)
table(is.na(base218$ingresos_esc))
table(base218$ingresos_esc)
table(base218$ingresos)
```

```{r eval=FALSE, include=FALSE}
baseafc<- ap_est %>% select(perc_trabajo_duro_est,perc_trabajo_duro_ap,perc_esfuerzo_est,perc_esfuerzo_ap, perc_falta_talento_ap, perc_falta_talento_est, perc_falta_esfuerzo_est, perc_falta_esfuerzo_ap,sj_indirect_noln, ingresos_pc, rbd_est)
baseafc <- set_na(baseafc, na = c(5,9), drop.levels = TRUE, as.tag = FALSE)
baseafc=na.omit(baseafc)



model01 <- 'perc_merit_est=~perc_trabajo_duro_est + perc_esfuerzo_est  
            atri_merit_est=~perc_falta_talento_est+perc_falta_esfuerzo_est
            perc_merit_ap=~perc_trabajo_duro_ap + perc_esfuerzo_ap  
            atri_merit_ap=~perc_falta_talento_ap+perc_falta_esfuerzo_ap
            '

fit1_o <- cfa(model = model01,data = baseafc,
            ordered = c("perc_trabajo_duro_est","perc_esfuerzo_est","perc_falta_talento_est", "perc_falta_esfuerzo_est","perc_trabajo_duro_ap","perc_esfuerzo_ap","perc_falta_talento_ap","perc_falta_esfuerzo_ap"))

#---------------------------------------------------#
fitMeasures(fit1_o, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea"))
summary(fit1_o, fit.measures=T, standardized=T)
```

```{r eval=FALSE, include=FALSE}
p1a <- predict(fit1_o)
scores_apod = as.data.frame(p1a)
# Merge with factor scores
apod_cfa2_sco = cbind(baseafc, scores_apod)
# Check
stargazer(apod_cfa2_sco, type = "text")
# Save  factor scores
```

```{r eval=FALSE, include=FALSE}
basecor<- apod_cfa2_sco[,9:15]
basecor<- basecor[-c(3)]

#basecor=na.omit(basecor)
cormat=cor(basecor, use = "na.or.complete")

#save
#png("output/results/corplot_totscores.png",width=600,height=600)
windowsFonts(A = windowsFont("Times New Roman"))
rownames(cormat) <-c(
    "A. Sentido de justicia notas",
    "B. Ingreso familiar",
    "C. Percepción meritocratica Estudiante",
    "D. Atribución de pobreza meritocratica Estudiante",
    "E. Percepción meritocratica Apoderado",
    "F. Atribución de pobreza meritocratica Apoderado")
colnames(cormat) <-c("(A)", "(B)","(C)","(D)","(E)","(F)")
corrplot(
cormat,
  method = "color",
  type = "upper",
  tl.col = "black",
  addCoef.col = "black",
  diag = TRUE,
  family = "A",
  number.font = 6,
  tl.cex =0.75,
  number.cex = 1)
```

## Parte 4: Análisis multivariado
### Modelos con promedios de indicadores como dependiente
#### Modelo 0: nulo con promedio indicadores
```{r Modelo 0: nulo con promedio indicadores}
# Percepción meritocracia
mmn_p <- lmer(prom_percmer_est ~ 1 + (1|rbd_est), data = ap_est)

#summary(mmn_p)
```

#### Modelo 1: L1 con promedio indicadores
```{r Modelo 1: L1 con promedio indicadores}
# Percepción meritocracia
mml1_p <- lmer(prom_percmer_est ~ 1 + perc_esfuerzo_factor_ap + 
                 perc_trabajo_duro_factor_ap + 
                 sj_indirect_ln + 
                 sj_direct_factor + 
                 ingresos_tramos_factor + 
                 (1|rbd_est), data = ap_est)

#summary(mml1_p)
```

#### Modelo 2: L2 con promedio indicadores
```{r Modelo 2: L2 con promedio indicadores}
# Percepción meritocracia
mml2_p <- lmer(prom_percmer_est ~ 1 + ingresos_esc + 
                 univ_esc + 
                 heterogen_esc 
              + (1|rbd_est), data = ap_est)

#summary(mml2_p)
```

#### Modelo 3: L1+L2 con promedio indicadores
```{r Modelo 3: L1+L2 con promedio indicadores}
# Percepción meritocracia
mml1l2_p <- lmer(prom_percmer_est ~ perc_esfuerzo_factor_ap + 
                 perc_trabajo_duro_factor_ap + 
                 sj_indirect_ln + 
                 sj_direct_factor + 
                 ingresos_tramos_factor + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc 
                + (1|rbd_est), data = ap_est)

#summary(mml1l2_p)
```

#### Modelo 4: interacción 1 y controles con promedio indicadores
```{r Modelo 4: interacción 1 y controles con promedio indicadores}
# Percepción meritocracia
mmin1_p <- lmer(prom_percmer_est ~ perc_esfuerzo_factor_ap + 
                 perc_trabajo_duro_factor_ap + 
                 sj_indirect_ln + 
                 sj_direct_factor + 
                 ingresos_tramos_factor + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_esfuerzo_factor_ap*sj_indirect_ln + # Interacción
                 region_factor_est +
                 dependencia_factor_est +
                 pos_pol_factor_est + 
                 genero_factor_est +
                 libros_hogar_factor_est + 
                 recompensa_factor_est + 
                 pos_pol_factor_ap +
                 genero_factor_ap +
                 educ_factor_ap +
                 libros_hogar_factor_ap +
                 recompensa_factor_ap +
                 edad +
                 (1|rbd_est), data = ap_est)

#summary(mmin1_p)
```

#### Modelo 4: interacción 2 y controles con promedio indicadores
```{r Modelo 4: interacción 2 y controles con promedio indicadores}
# Percepción meritocracia
mmin2_p <- lmer(prom_percmer_est ~ perc_esfuerzo_factor_ap + 
                 perc_trabajo_duro_factor_ap + 
                 sj_indirect_ln + 
                 sj_direct_factor + 
                 ingresos_tramos_factor + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_trabajo_duro_factor_ap*sj_indirect_ln + # Interacción
                 region_factor_est +
                 dependencia_factor_est +
                 pos_pol_factor_est + 
                 genero_factor_est +
                 libros_hogar_factor_est + 
                 recompensa_factor_est + 
                 pos_pol_factor_ap +
                 genero_factor_ap +
                 educ_factor_ap +
                 libros_hogar_factor_ap +
                 recompensa_factor_ap +
                 edad +
                 (1|rbd_est), data = ap_est)

#summary(mmin2_p)
```

#### Modelo 4: interacción 3 y controles con promedio indicadores
```{r Modelo 4: interacción 3 y controles con promedio indicadores}
# Percepción meritocracia
mmin3_p <- lmer(prom_percmer_est ~ perc_esfuerzo_factor_ap + 
                 perc_trabajo_duro_factor_ap + 
                 sj_indirect_ln + 
                 sj_direct_factor + 
                 ingresos_tramos_factor + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 #perc_esfuerzo_factor_ap*sj_direct_factor + # Interacción (No funciona)
                 region_factor_est +
                 dependencia_factor_est +
                 pos_pol_factor_est + 
                 genero_factor_est ++
                 libros_hogar_factor_est + 
                 recompensa_factor_est + 
                 pos_pol_factor_ap +
                 genero_factor_ap +
                 educ_factor_ap +
                 libros_hogar_factor_ap +
                 recompensa_factor_ap +
                 edad +
                 (1|rbd_est), data = ap_est)
#summary(mmin3_p)
```

#### Modelo 4: interacción 4 y controles con promedio indicadores
```{r Modelo 4: interacción 4 y controles con promedio indicadores}
# Percepción meritocracia
mmin4_p <- lmer(prom_percmer_est ~ perc_esfuerzo_factor_ap + 
                 perc_trabajo_duro_factor_ap + 
                 sj_indirect_ln + 
                 sj_direct_factor + 
                 ingresos_tramos_factor + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_trabajo_duro_factor_ap*sj_direct_factor + # Interacción
                 region_factor_est +
                 dependencia_factor_est +
                 pos_pol_factor_est + 
                 genero_factor_est +
                 libros_hogar_factor_est + 
                 recompensa_factor_est + 
                 pos_pol_factor_ap +
                 genero_factor_ap +
                 educ_factor_ap +
                 libros_hogar_factor_ap +
                 recompensa_factor_ap +
                 edad +
                 (1|rbd_est), data = ap_est)

#summary(mmin4_p)
```

### Tabla de modelos con promedio de indicadores
```{r Tabla de modelos con promedio de indicadores, results='asis'}

htmlreg(list(mmn_p, mml1_p, mml2_p, mml1l2_p, mmin1_p, mmin2_p, mmin3_p, mmin4_p), custom.model.names = c("Nulo", "L1", "L2", "L1+L2", "I1", "I2", "I3", "I4"),
        
#custom.coef.names = c("Intercepto", "Perc. Esfuerzo Ap.", "Perc.Trabajo duro Ap.", "Sj Indirecto", "Sj Directo", "Ingreso tramos", "Ingresos por escuela", "Ed. Universitaria por escuela", "Heterogeneidad económica por escuela", "Perc. Esfuerzo Ap.*Sj Indirecto", "Perc. Trabajo duro Ap.*Sj Indirecto", "Perc. Esfuerzo. Ap*Sj Directo","Perc. Trabajo duro*Sj Directo", "Región", "Dependencia", "Posición política Est.", "Género Est.", "Ed. Padre", "Ed. Madre", "Libros hogar Est.", "Recompensa Est.", "Posición Política Ap.", "Género Ap.", "Ed. Ap", "Libros hogar Ap.", "Recompensa Ap.", "Edad Ap."),  

star.symbol = "\\*", center = T, custom.note = " <div style='text-align: justify'> $***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br>" , caption.above = T, caption = "Socialización de la percepción meritocratica")
```

### Modelos con indicadores separados como dependiente
```{r Modelos 0: nulos con indicadores separados, eval=FALSE, include=FALSE}
# Esfuerzo
mmn_e <- clmm(factor(perc_esfuerzo_est) ~ 1 + (1|rbd_est), data = ap_est)

# Trabajo duro
mmn_td <- clmm(factor(perc_trabajo_duro_est) ~ 1 + (1|rbd_est), data = ap_est)

```

```{r # Modelos 1: L1 con indicadores separado, eval=FALSE, include=FALSE}
# Esfuerzo
mml1_e <- clmm(factor(perc_esfuerzo_est) ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 (1|rbd_est), data = ap_est)

# Trabajo duro
mml1_td <- clmm(factor(perc_trabajo_duro_est) ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 (1|rbd_est), data = ap_est)
```

```{r Modelos 2: L2 con indicadores separados, eval=FALSE, include=FALSE}
# Esfuerzo
mml2_e <- clmm(factor(perc_esfuerzo_est) ~ ingresos_esc + 
               univ_esc + 
              heterogen_esc
             + (1|rbd_est), data = ap_est) # clmm no funciona con L2, coeficientes dan NA.


mml2_e <- mixor(factor(perc_esfuerzo_est) ~ ingresos_esc + 
                 univ_esc + 
                 heterogen_esc, data = ap_est_rbd, id = rbd_est, link="logit")

# Trabajo duro
mml2_td <- clmm(factor(perc_trabajo_duro_est) ~ ingresos_esc + 
               univ_esc + 
              heterogen_esc
              + (1|rbd_est), data = ap_est) # clmm no funciona con L2, coeficientes dan NA.

mml2_td <- mixor(factor(perc_trabajo_duro_est) ~ ingresos_esc + 
                 univ_esc + 
                 heterogen_esc, data = ap_est_rbd, id = rbd_est, link="logit")
```

```{r Modelos 3: L1+L2 con indicadores separados, eval=FALSE, include=FALSE}
# Esfuerzo
mml1l2_e <- clmm(factor(perc_esfuerzo_est) ~ + perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc 
                 + (1|rbd_est), data = ap_est) # clmm no funciona con L2, coeficientes dan NA.

mml1l2_e <- mixor(perc_esfuerzo_est ~ perc_esfuerzo_ap + 
                perc_trabajo_duro_ap + 
               sj_indirect_ln + 
              sj_direct + 
             ingresos_tramos + 
            ingresos_esc + 
           univ_esc + 
          heterogen_esc, data = ap_est_rbd, id = rbd_est, link="logit") # Se queda pegado

# Trabajo duro
mml1l2_td <- clmm(factor(perc_trabajo_duro_est) ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc 
                 + (1|rbd_est), data = ap_est) # clmm no funciona con L2, coeficientes dan NA.

mml1l2_td <- mixor(factor(perc_trabajo_duro_est) ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc, data = ap_est_rbd, id = rbd_est, link="logit")
```

```{r Modelo 4: interacción 1 y controles con indicadores separados, eval=FALSE, include=FALSE}
# Esfuerzo
mmin1_e <- clmm(perc_esfuerzo_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_esfuerzo_ap*sj_indirect_ln + # Interacción
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

# Trabajo duro
mmin1_td <- clmm(perc_trabajo_duro_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_esfuerzo_ap*sj_indirect_ln + # Interacción
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

```

```{r Modelo 4: interacción 2 y controles con indicadores separados, eval=FALSE, include=FALSE}
# Esfuerzo
mmin2_e <- clmm(perc_esfuerzo_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_trabajo_duro_ap*sj_indirect_ln + # Interacción
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

# Trabajo duro

mmin2_td <- clmm(perc_trabajo_duro_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_trabajo_duro_ap*sj_indirect_ln + # Interacción
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

```

```{r Modelo 4: interacción 3 y controles con indicadores separados, eval=FALSE, include=FALSE}
# Esfuerzo
mmin3_e <- clmm(perc_esfuerzo_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_esfuerzo_ap*sj_direct + # Interacción
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

# Trabajo duro
mmin3_td <- clmm(perc_trabajo_duro_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_esfuerzo_ap*sj_direct + # Interacción 
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

```

```{r Modelo 4: interacción 4 y controles con indicadores separados, eval=FALSE, include=FALSE}
# Esfuerzo
mmin4_e <- clmm(perc_esfuerzo_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_trabajo_duro_ap*sj_direct + # Interacción
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

# Trabajo duro
mmin4_td <- clmm(perc_trabajo_duro_est ~ perc_esfuerzo_ap + 
                 perc_trabajo_duro_ap + 
                 sj_indirect_ln + 
                 sj_direct + 
                 ingresos_tramos + 
                 ingresos_esc + 
                 univ_esc + 
                 heterogen_esc + 
                 perc_trabajo_duro_ap*sj_direct + # Interacción
                 region_est +
                 dependencia_est +
                 pos_pol_est + 
                 genero_est +
                 educ_padre +
                 educ_madre +
                 libros_hogar_est + 
                 recompensa + 
                 pos_pol_ap +
                 genero_ap +
                 educ +
                 libros_hogar_ap +
                 recompensa_hijos +
                 edad +
                 (1|rbd_est), data = ap_est)

```


```{r eval=FALSE, include=FALSE, results='asis'}
results_0_accum  = lmer(perc_merit_est ~ 1 + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_1_accum  = lmer(perc_merit_est ~ 1 + ingresos_pc + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_2_accum  = lmer(perc_merit_est ~ 1 + sj_indirect_noln + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_3_accum  = lmer(perc_merit_est ~ 1 +  perc_merit_ap + (1| rbd_est), data = apod_cfa2_sco, REML=F)
results_4_accum  = lmer(perc_merit_est ~ 1 + atri_merit_ap + (1| rbd_est), data = apod_cfa2_sco, REML=F)

results_5_accum  = lmer(perc_merit_est ~ 1 + perc_merit_ap + atri_merit_ap +  sj_indirect_noln + ingresos_pc + (1| rbd_est), data = apod_cfa2_sco, REML=F)

htmlreg(list(results_0_accum, results_1_accum,results_2_accum, results_3_accum,results_4_accum,results_5_accum), custom.coef.names = c("Intercepto", "Ingresos Percapita", "Sentido de justicia", "Percepción Meritocratica Apoderados", "Atribución Meritocratica Apoderados"), star.symbol = "\\*", center = T, custom.note = " <div style='text-align: justify'> $***p <$ 0.001, $**p <$ 0.01, $*p <$ 0.05 <br>" , caption.above = T, caption = "Socialización de la percepción meritocratica")

```



